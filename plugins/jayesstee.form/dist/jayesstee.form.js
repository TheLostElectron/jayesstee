"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JstForm=undefined;var _keys=require("babel-runtime/core-js/object/keys");var _keys2=_interopRequireDefault(_keys);var _getIterator2=require("babel-runtime/core-js/get-iterator");var _getIterator3=_interopRequireDefault(_getIterator2);var _assign=require("babel-runtime/core-js/object/assign");var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of");var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _jayesstee=require("jayesstee");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Input=function(_jst$Object){(0,_inherits3.default)(Input,_jst$Object);function Input(opts,css){(0,_classCallCheck3.default)(this,Input);var _this=(0,_possibleConstructorReturn3.default)(this,(Input.__proto__||(0,_getPrototypeOf2.default)(Input)).call(this));_this.opts=(0,_assign2.default)({attrs:{}},opts);if(opts.ref){_this.opts.attrs.ref=opts.ref}if(opts.events){var events=(0,_assign2.default)({},opts.events);if(!opts.type||opts.type==="text"){if(events.input){(function(){var oldEvent=events.input;events.input=function(e){oldEvent(e);_this.inputChanged(e)}})()}else{events.input=function(e){return _this.inputChanged(e)}}}_this.opts.attrs.events=events}_this.localCss=css;if(opts.css){_this.instanceCss=(0,_assign2.default)({},opts.css);_this.cssInstance=function(){return _this.instanceCss}}return _this}(0,_createClass3.default)(Input,[{key:"cssLocal",value:function cssLocal(){return[{".input input":{padding$px:2},".input fieldset":{border:"none",borderRadius$px:3,margin$px:0},".input input[type=button]":{margin$px:5,borderRadius$px:3,padding$px:4},".input legend":{fontWeight:"bold"},".checkbox-item-label, .radio-item-label":{margin$px:[0,5]},".input input[type=checkbox], .input input[type=radio]":{marginLeft$px:8},completionList$c:{display:"table",position:"absolute",padding$px:0,fontSize:"70%",backgroundColor:"#eee"},completionItem$c:{padding$px:[2,5],border$px:["solid",1,_jayesstee.jst.rgba(0,0,0,0.1)]},completionItem$c$hover:{backgroundColor:"#fff",cursor:"pointer"},label$c:{display:"inline-block",fontWeight:"bold",marginRight:10,minWidth$em:6}},this.localCss]}},{key:"render",value:function render(){return[_jayesstee.jst.$div({cn:"-input --input"},this.renderField(this.opts))]}},{key:"renderField",value:function renderField(field){return _jayesstee.jst.$div({cn:"-field-container"},this["render"+field.type]?this["render"+field.type](field):this.renderinput(field))}},{key:"renderinput",value:function renderinput(field){var _this2=this;return _jayesstee.jst.$fieldset(console.log("field:",field),!field.label?undefined:_jayesstee.jst.$label({cn:"-label --label"},field.label),_jayesstee.jst.$div({cn:"-textInputContainer"},_jayesstee.jst.$input((0,_assign2.default)({type:field.type?field.type:"text"},field.attrs)),console.log("no values:",field),!field.completionValues?undefined:_jayesstee.jst.$div({cn:"-completionList"},field.completionValues.map(function(item){return _jayesstee.jst.$div({cn:"-completionItem",events:{click:function click(e){return _this2.completionSelect(item,e)}}},item)}))))}},{key:"renderpassword",value:function renderpassword(field){return _jayesstee.jst.$fieldset(_jayesstee.jst.$label({cn:"-label --label"},field.label),_jayesstee.jst.$input((0,_assign2.default)({type:"password",name:field.name},field.attrs)))}},{key:"rendercheckbox",value:function rendercheckbox(field){var _this3=this;return _jayesstee.jst.$fieldset(field.legend?_jayesstee.jst.$legend(field.legend):undefined,field.label?_jayesstee.jst.$legend(field.label):undefined,field.items.map(function(item){return _this3.renderCheckboxItem(field.name,item)}))}},{key:"renderradio",value:function renderradio(field){var _this4=this;return _jayesstee.jst.$fieldset(field.legend?_jayesstee.jst.$legend(field.legend):undefined,field.label?_jayesstee.jst.$legend(field.label):undefined,field.items.map(function(item){return _this4.renderRadioItem(field.name,field.events,item)}))}},{key:"renderselect",value:function renderselect(field){var _this5=this;return _jayesstee.jst.$fieldset(field.label?_jayesstee.jst.$label({cn:"-label --label"},field.label):undefined,_jayesstee.jst.$select(field.attrs,field.items.map(function(item){return _this5.renderSelectOption(field.name,item)})))}},{key:"renderTextarea",value:function renderTextarea(field){return _jayesstee.jst.$textarea(field.attrs,field.value)}},{key:"renderRadioItem",value:function renderRadioItem(name,events,item){return[_jayesstee.jst.$input({cn:"-radio-item",type:"radio",id:item.id,name:name,events:events}),_jayesstee.jst.$label({cn:"-radio-item-label",for:item.id},item.text||item.value),item.noBreak?undefined:_jayesstee.jst.$br()]}},{key:"renderCheckboxItem",value:function renderCheckboxItem(name,events,item){return[_jayesstee.jst.$input({type:"checkbox",id:item.id,name:name,value:item.value,events:events,properties:item.checked?["checked"]:undefined}),_jayesstee.jst.$label({cn:"-checkbox-item-label",for:item.id},item.text||item.value),item.noBreak?undefined:_jayesstee.jst.$br()]}},{key:"renderSelectOption",value:function renderSelectOption(name,item){return[_jayesstee.jst.$option({cn:"-select-item",value:item.id||item.name||item.value,properties:item.checked||item.selected?["selected"]:undefined},item.text||item.name||item.id||item.value)]}},{key:"getValue",value:function getValue(){if(this.inputEl&&this.inputEl.el){return this.inputEl.el.value}return undefined}},{key:"setValue",value:function setValue(val){if(this.inputEl&&this.inputEl.el){this.inputEl.el.value=val}this.inputEl.value=val;this.opts.completionValues=undefined;this.refresh()}},{key:"setCompletionValues",value:function setCompletionValues(list){this.completionValues=list;this.doCompletion()}},{key:"doCompletion",value:function doCompletion(){var _this6=this;if(this.completionValues&&this.type!=="text"){var curr=this.getValue()||"";if(curr.length==1){(function(){var re=new RegExp("^"+curr,"i");_this6.opts.completionValues=_this6.completionValues.filter(function(word){return word&&word.match(re)})})()}else if(curr.length>1){(function(){var re=new RegExp(curr,"i");_this6.opts.completionValues=_this6.completionValues.filter(function(word){return word&&word.match(re)})})()}else{this.opts.completionValues=[]}if(this.opts.completionValues.length>8){this.opts.completionValues.splice(8)}this.refresh()}}},{key:"completionSelect",value:function completionSelect(item,e){this.setValue(item)}},{key:"inputChanged",value:function inputChanged(e){this.doCompletion()}},{key:"focus",value:function focus(){if(this.inputEl&&this.inputEl.el){this.inputEl.el.focus()}}}]);return Input}(_jayesstee.jst.Object);var JstForm=exports.JstForm=function(_jst$Object2){(0,_inherits3.default)(JstForm,_jst$Object2);function JstForm(opts){(0,_classCallCheck3.default)(this,JstForm);var _this7=(0,_possibleConstructorReturn3.default)(this,(JstForm.__proto__||(0,_getPrototypeOf2.default)(JstForm)).call(this));_this7.name=opts.name;_this7.events=opts.events;_this7.css=opts.css||{};_this7.inputs=[];_this7.inputsByName={};_this7.createInputs(opts.inputs);return _this7}(0,_createClass3.default)(JstForm,[{key:"render",value:function render(){return _jayesstee.jst.$form({name:this.name,events:this.events},this.inputs)}},{key:"createInput",value:function createInput(opts){if(typeof opts.name=="undefined"){throw Error("opts.name must be defined on all inputs")}var optsWithRef=(0,_assign2.default)({ref:"inputEl"},opts);var input=new Input(optsWithRef,this.css);this.inputs.push(input);this.inputsByName[opts.name]=input;return input}},{key:"createInputs",value:function createInputs(inputs){var _this8=this;if(inputs&&inputs.length){inputs.map(function(input){return _this8.createInput(input)})}}},{key:"getValues",value:function getValues(){var vals={};var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=(0,_getIterator3.default)((0,_keys2.default)(this.inputsByName)),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var name=_step.value;vals[name]=this.inputsByName[name].getValue()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return vals}}]);return JstForm}(_jayesstee.jst.Object);
//# sourceMappingURL=jayesstee.form.js.map