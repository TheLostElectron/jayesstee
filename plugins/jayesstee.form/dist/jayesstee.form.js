"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JstFormElement=exports.jstform=undefined;var _defineProperty2=require("babel-runtime/helpers/defineProperty");var _defineProperty3=_interopRequireDefault(_defineProperty2);var _keys=require("babel-runtime/core-js/object/keys");var _keys2=_interopRequireDefault(_keys);var _getIterator2=require("babel-runtime/core-js/get-iterator");var _getIterator3=_interopRequireDefault(_getIterator2);var _get2=require("babel-runtime/helpers/get");var _get3=_interopRequireDefault(_get2);var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of");var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _assign=require("babel-runtime/core-js/object/assign");var _assign2=_interopRequireDefault(_assign);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _typeToClass;var _jayesstee=require("jayesstee");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var defaults={color:{textLight:"#fff",textDark:"#000",backgroundLight:"#eee",backgroundDark:"#555",highlight:"#eee"},font:{size:"13pt",family:"Arial"},label:{position:"top"}};var JstForm=function(){function JstForm(){(0,_classCallCheck3.default)(this,JstForm);this.defaults=defaults}(0,_createClass3.default)(JstForm,[{key:"setDefaults",value:function setDefaults(opts){this.defaults=(0,_assign2.default)(defaults,opts)}},{key:"$input",value:function $input(opts){if(opts.type&&typeToClass[opts.type]){return new typeToClass[opts.type](this,opts)}else{return new Input(this,opts)}}},{key:"$form",value:function $form(opts){return new JstFormElement(opts)}}]);return JstForm}();var jstform=exports.jstform=new JstForm;var Input=function(_jst$Object){(0,_inherits3.default)(Input,_jst$Object);function Input(form,opts){(0,_classCallCheck3.default)(this,Input);var _this=(0,_possibleConstructorReturn3.default)(this,(Input.__proto__||(0,_getPrototypeOf2.default)(Input)).call(this));_this.defaults=form.defaults;_this.opts=(0,_assign2.default)({attrs:{}},opts);if(opts.ref){_this.opts.attrs.ref=opts.ref}else{_this.opts.attrs.ref="inputEl"}if(opts.events){var events=(0,_assign2.default)({},opts.events);if(!opts.type||opts.type==="text"){if(events.input){(function(){var oldEvent=events.input;events.input=function(e){oldEvent(e);_this.inputChanged(e)}})()}else{events.input=function(e){return _this.inputChanged(e)}}if(events.keydown){(function(){var oldEvent=events.keydown;events.keydown=function(e){oldEvent(e);_this.inputKeyDown(e)}})()}else{events.keydown=function(e){return _this.inputKeyDown(e)}}}_this.opts.attrs.events=events}else if(!opts.type||opts.type==="text"){_this.opts.attrs.events={input:function input(e){return _this.inputChanged(e)},keydown:function keydown(e){return _this.inputKeyDown(e)}}}if(opts.css){_this.instanceCss=(0,_assign2.default)({},opts.css);_this.cssInstance=function(){return _this.instanceCss}}return _this}(0,_createClass3.default)(Input,[{key:"cssLocal",value:function cssLocal(){return[{input$c:{marginLeft$px:8},".input input":{padding$px:2},".input fieldset":{border:"none",borderRadius$px:3,margin$px:0,padding$px:[2,2,2,8]},".inputLabel":{display:this.defaults.label.position=="top"?"block":"inline-block",fontFamily:this.defaults.font.family,fontSize:this.defaults.font.size,color:this.defaults.color.textDark,fontWeight:"bold",minWidth$em:7},inputInner$c:{display:this.defaults.label.position=="top"?"block":"inline-block"},completionList$c:{display:"table",position:"absolute",padding$px:0,fontSize:"70%",backgroundColor:"#eee"},completionItem$c:{padding$px:[2,5],border$px:["solid",1,_jayesstee.jst.rgba(0,0,0,0.1)]},completionItem$c$hover:{backgroundColor:"#fff",cursor:"pointer"},selected$c:{backgroundColor:"#fff"},bannerSelect$c:{display:"inline-block"},bannerSelectItem$c:{display:"inline-block",fontSize$px:13,cursor:"pointer",padding$px:[2,10],backgroundColor:"#ccc",color:"white"},".bannerSelectItem:first-child":{borderRadius$px:[8,0,0,8]},".bannerSelectItem:last-child":{borderRadius$px:[0,8,8,0]}},this.localCss]}},{key:"render",value:function render(){var _this2=this;return[this.renderInput(_jayesstee.jst.$input((0,_assign2.default)({type:this.opts.type?this.opts.type:"text",ref:"inputEl"},this.opts.attrs)),!this.completionValues?undefined:_jayesstee.jst.$div({cn:"-completionList"},this.completionValues.map(function(item){return _jayesstee.jst.$div({cn:"-completionItem "+(item.selected?"-selected":""),events:{click:function click(e){return _this2.completionSelect(item,e)}}},item.text)})))]}},{key:"renderInput",value:function renderInput(){for(var _len=arguments.length,inners=Array(_len),_key=0;_key<_len;_key++){inners[_key]=arguments[_key]}return[_jayesstee.jst.$div({cn:"-input --input"},_jayesstee.jst.$fieldset(this.opts.legend?_jayesstee.jst.$div({cn:"-inputLabel --inputLabel"},this.opts.legend):undefined,this.opts.label?_jayesstee.jst.$div({cn:"-inputLabel --inputLabel"},this.opts.label):undefined,_jayesstee.jst.$div({cn:"-inputInner"},inners)))]}},{key:"getValue",value:function getValue(){if(this.inputEl&&this.inputEl.el){return this.inputEl.el.value}return undefined}},{key:"inputKeyDown",value:function inputKeyDown(e){if(e.key==="ArrowDown"){if(this.completionValues){this.completionIndex=typeof this.completionIndex==="undefined"?0:this.completionIndex=(this.completionIndex+1)%this.completionValues.length;this.markCompletionValue()}}else if(e.key==="ArrowUp"){if(this.completionValues){this.completionIndex=this.completionIndex?this.completionIndex-1:this.completionValues.length-1;this.markCompletionValue()}}else if(e.key==="Enter"){if(this.completionValues&&this.completionValues.length&&typeof this.completionIndex!=="undefined"){this.completionSelect(this.completionValues[this.completionIndex],e)}else{if(this.opts.attrs.events.submit){this.opts.attrs.events.submit()}}}this.refresh()}},{key:"setValue",value:function setValue(val){if(this.inputEl&&this.inputEl.el){this.inputEl.el.value=val}this.inputEl.value=val;this.completionValues=undefined;this.refresh()}},{key:"setCompletionValues",value:function setCompletionValues(list){this.completionChoices=list.map(function(word){return{text:word}});this.doCompletion()}},{key:"doCompletion",value:function doCompletion(){var _this3=this;if(this.completionChoices){var curr=this.getValue()||"";if(curr.length==1){(function(){var re=new RegExp("^"+curr,"i");_this3.completionValues=_this3.completionChoices.filter(function(item){return item.text&&item.text.match(re)})})()}else if(curr.length>1){(function(){var re=new RegExp(curr,"i");_this3.completionValues=_this3.completionChoices.filter(function(item){return item.text&&item.text.match(re)})})()}else{this.completionValues=[]}if(this.completionValues.length>8){this.completionValues.splice(8)}this.refresh()}}},{key:"markCompletionValue",value:function markCompletionValue(){this.completionValues.map(function(item){return item.selected=false});this.completionValues[this.completionIndex].selected=true}},{key:"completionSelect",value:function completionSelect(item,e){this.setValue(item.text)}},{key:"inputChanged",value:function inputChanged(e){this.doCompletion()}},{key:"focus",value:function focus(){if(this.inputEl&&this.inputEl.el){this.inputEl.el.focus()}}}]);return Input}(_jayesstee.jst.Object);var InputRadioOrCheckbox=function(_Input){(0,_inherits3.default)(InputRadioOrCheckbox,_Input);function InputRadioOrCheckbox(form,opts){(0,_classCallCheck3.default)(this,InputRadioOrCheckbox);return(0,_possibleConstructorReturn3.default)(this,(InputRadioOrCheckbox.__proto__||(0,_getPrototypeOf2.default)(InputRadioOrCheckbox)).call(this,form,opts))}(0,_createClass3.default)(InputRadioOrCheckbox,[{key:"cssLocal",value:function cssLocal(){return[(0,_get3.default)(InputRadioOrCheckbox.prototype.__proto__||(0,_getPrototypeOf2.default)(InputRadioOrCheckbox.prototype),"cssLocal",this).call(this),{itemLabel$c:{margin$px:[0,5]},input$c:{marginLeft$px:8}}]}},{key:"render",value:function render(){var _this5=this;return(0,_get3.default)(InputRadioOrCheckbox.prototype.__proto__||(0,_getPrototypeOf2.default)(InputRadioOrCheckbox.prototype),"renderInput",this).call(this,_jayesstee.jst.$fieldset(this.opts.legend?_jayesstee.jst.$legend(this.opts.legend):undefined,this.opts.label?_jayesstee.jst.$legend(this.opts.label):undefined,this.opts.items.map(function(item){return _this5.renderItem(_this5.opts.name,_this5.opts.events,item)})))}},{key:"renderItem",value:function renderItem(name,events,item){return[_jayesstee.jst.$input({cn:"-item --item",type:this.opts.type,id:item.id,name:name,events:events}),_jayesstee.jst.$label({cn:"-itemLabel --itemLabel",for:item.id},item.text||item.value),item.noBreak?undefined:_jayesstee.jst.$br()]}}]);return InputRadioOrCheckbox}(Input);var InputButton=function(_Input2){(0,_inherits3.default)(InputButton,_Input2);function InputButton(form,opts){(0,_classCallCheck3.default)(this,InputButton);return(0,_possibleConstructorReturn3.default)(this,(InputButton.__proto__||(0,_getPrototypeOf2.default)(InputButton)).call(this,form,opts))}(0,_createClass3.default)(InputButton,[{key:"cssLocal",value:function cssLocal(){return[(0,_get3.default)(InputButton.prototype.__proto__||(0,_getPrototypeOf2.default)(InputButton.prototype),"cssLocal",this).call(this),{button$c:{margin$px:[0,5],padding$px:4}}]}},{key:"render",value:function render(){return(0,_get3.default)(InputButton.prototype.__proto__||(0,_getPrototypeOf2.default)(InputButton.prototype),"renderInput",this).call(this,_jayesstee.jst.$fieldset(this.opts.legend?_jayesstee.jst.$legend(this.opts.legend):undefined,this.opts.label?_jayesstee.jst.$legend(this.opts.label):undefined,_jayesstee.jst.$button((0,_assign2.default)({cn:"-button --button"},this.opts.attrs),this.opts.value)))}}]);return InputButton}(Input);var InputTextArea=function(_Input3){(0,_inherits3.default)(InputTextArea,_Input3);function InputTextArea(form,opts){(0,_classCallCheck3.default)(this,InputTextArea);return(0,_possibleConstructorReturn3.default)(this,(InputTextArea.__proto__||(0,_getPrototypeOf2.default)(InputTextArea)).call(this,form,opts))}(0,_createClass3.default)(InputTextArea,[{key:"cssLocal",value:function cssLocal(){return[(0,_get3.default)(InputTextArea.prototype.__proto__||(0,_getPrototypeOf2.default)(InputTextArea.prototype),"cssLocal",this).call(this),{textArea$c:{margin$px:[0,5]},input$c:{marginLeft$px:8}}]}},{key:"render",value:function render(){return _jayesstee.jst.$textarea((0,_assign2.default)({cn:"-textArea --textArea"},this.opts.attrs),this.opts.value)}}]);return InputTextArea}(Input);var InputSelect=function(_Input4){(0,_inherits3.default)(InputSelect,_Input4);function InputSelect(form,opts){(0,_classCallCheck3.default)(this,InputSelect);var _this8=(0,_possibleConstructorReturn3.default)(this,(InputSelect.__proto__||(0,_getPrototypeOf2.default)(InputSelect)).call(this,form,opts));if(_this8.opts.selectType==="banner"){if(_this8.opts.events){_this8.bannerChange=_this8.opts.events.change;_this8.bannerClick=_this8.opts.events.click;delete _this8.opts.events}}return _this8}(0,_createClass3.default)(InputSelect,[{key:"cssLocal",value:function cssLocal(){return[(0,_get3.default)(InputSelect.prototype.__proto__||(0,_getPrototypeOf2.default)(InputSelect.prototype),"cssLocal",this).call(this),{bannerSelect$c:{display:"inline-block"},bannerSelectItem$c:{display:"inline-block",fontSize$px:13,cursor:"pointer",padding$px:[2,10],backgroundColor:this.defaults.color.backgroundDark,color:this.defaults.color.textLight},bannerSelectItem$c$hover:{backgroundColor:this.defaults.color.highlight,color:this.defaults.color.textDark},selected$c:{backgroundColor:this.defaults.color.highlight,color:this.defaults.color.textDark}}]}},{key:"render",value:function render(){var _this9=this;if(this.opts.selectType==="banner"){return this.renderInput(_jayesstee.jst.$div({cn:"-bannerSelect --bannerSelect"},this.opts.attrs,this.opts.items?this.opts.items.map(function(item){return _this9.renderBannerSelectOption(_this9.opts.name,item)}):undefined))}else{return this.renderInput(_jayesstee.jst.$select(this.opts.attrs,this.opts.items?this.opts.items.map(function(item){return _this9.renderSelectOption(_this9.opts.name,item)}):undefined))}}},{key:"renderSelectOption",value:function renderSelectOption(name,item){return[_jayesstee.jst.$option({cn:"-selectItem",value:item.value||item.id||item.name,properties:item.checked||item.selected?["selected"]:undefined},item.text||item.name||item.id||item.value)]}},{key:"renderBannerSelectOption",value:function renderBannerSelectOption(name,item){var _this10=this;return _jayesstee.jst.$div({cn:"-bannerSelectItem "+(item.selected?"-selected":""),value:item.value||item.id||item.name,events:{click:function click(e){return _this10.bannerItemSelect(item)}}},item.text||item.name||item.id||item.value)}},{key:"getValue",value:function getValue(){if(this.opts.selectType==="banner"){var selectedItem=void 0;this.opts.items.map(function(item){if(item.selected){selectedItem=item}});return selectedItem.value||selectedItem.id||selectedItem.name}else{if(this.inputEl&&this.inputEl.el){return this.inputEl.el.value}}return undefined}},{key:"bannerItemSelect",value:function bannerItemSelect(item){this.opts.items.map(function(item){return item.selected=false});item.selected=true;this.refresh();if(this.bannerClick){this.bannerClick(item)}if(this.bannerChange){this.bannerChange(item)}}}]);return InputSelect}(Input);var JstFormElement=exports.JstFormElement=function(_jst$Object2){(0,_inherits3.default)(JstFormElement,_jst$Object2);function JstFormElement(opts){(0,_classCallCheck3.default)(this,JstFormElement);var _this11=(0,_possibleConstructorReturn3.default)(this,(JstFormElement.__proto__||(0,_getPrototypeOf2.default)(JstFormElement)).call(this));_this11.name=opts.name;_this11.events=opts.events;_this11.css=opts.css||{};_this11.inputs=[];_this11.inputsByName={};_this11.createInputs(opts.inputs);return _this11}(0,_createClass3.default)(JstFormElement,[{key:"render",value:function render(){return _jayesstee.jst.$form({name:this.name,events:this.events},this.inputs)}},{key:"createInput",value:function createInput(opts){if(typeof opts.name=="undefined"){throw Error("opts.name must be defined on all inputs")}var optsWithRef=(0,_assign2.default)({ref:"inputEl"},opts);var input=new Input(this,optsWithRef,this.css);this.inputs.push(input);this.inputsByName[opts.name]=input;return input}},{key:"createInputs",value:function createInputs(inputs){var _this12=this;if(inputs&&inputs.length){inputs.map(function(input){return _this12.createInput(input)})}}},{key:"getValues",value:function getValues(){var vals={};var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=(0,_getIterator3.default)((0,_keys2.default)(this.inputsByName)),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var name=_step.value;vals[name]=this.inputsByName[name].getValue()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return vals}}]);return JstFormElement}(_jayesstee.jst.Object);var typeToClass=(_typeToClass={select:InputSelect,checkbox:InputRadioOrCheckbox,radio:InputRadioOrCheckbox,textarea:InputTextArea,button:InputButton,color:Input,date:Input,datetime:Input,email:Input,file:Input,hidden:Input,image:Input,month:Input,number:Input,password:Input},(0,_defineProperty3.default)(_typeToClass,"radio",Input),(0,_defineProperty3.default)(_typeToClass,"range",Input),(0,_defineProperty3.default)(_typeToClass,"reset",Input),(0,_defineProperty3.default)(_typeToClass,"search",Input),(0,_defineProperty3.default)(_typeToClass,"submit",InputButton),(0,_defineProperty3.default)(_typeToClass,"tel",Input),(0,_defineProperty3.default)(_typeToClass,"text",Input),(0,_defineProperty3.default)(_typeToClass,"time",Input),(0,_defineProperty3.default)(_typeToClass,"url",Input),(0,_defineProperty3.default)(_typeToClass,"week",Input),_typeToClass);
//# sourceMappingURL=jayesstee.form.js.map