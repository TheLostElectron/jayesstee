{"version":3,"sources":["../src/jayesstee.js"],"names":["jst","selectorOrElement","HTMLElement","JstElement","el","document","querySelector","globalJstObjectId","globalJstElementId","JstObject","companionObj","_jstId","parent","undefined","renderFunc","update","Error","refName","val","tag","params","id","contents","attrs","props","events","opts","tagName","toLowerCase","_processParams","dom","isDomified","arguments","innerHTML","atts","appendChild","apply","html","depth","indent","repeat","attrName","push","_quoteAttrValue","length","join","item","type","value","console","log","lastJstObject","createElement","ref","setRef","setAttribute","propName","event","addEventListener","listener","nextEl","i","hasEl","childEl","jstObject","aId","insertBefore","createTextNode","warn","_deleteItem","parentNode","removeChild","forceUpdate","items","render","newJst","_compareAndCopy","topNode","level","oldIndex","newIndex","copyJst","removeAttribute","fixProps","prop","eventName","removeEventListener","oldItem","newItem","doReplace","textContent","oldStartIndex","splice","newItems","setParent","contentsItem","delete","_flatten","param","toString","getParent","name","jstoptions","Object","properties","Array","Function","replace","fn","prototype","extend","target","options","copy","tagPrefix","tags","addCustomElements","names","fullName","args","init","object","obj","$jst","makeGlobal","prefix","global","globalTagPrefix","g","window","flat","result"],"mappings":"s5BAMgBA,G,CAAAA,G,mFAAT,QAASA,IAAT,CAAaC,iBAAb,CAAgC,CACrC,GAAIA,4BAA6BC,YAAjC,CAA8C,CAC5C,MAAO,IAAIC,WAAJ,CAAeF,iBAAf,CACR,CAFD,IAGK,CACH,GAAIG,IAAKC,SAASC,aAAT,CAAuBL,iBAAvB,CAAT,CACA,GAAI,CAACG,EAAL,CAAS,CACP,MAAO,IAAID,WACZ,CAFD,IAGK,CACH,MAAO,IAAIA,WAAJ,CAAeC,EAAf,CACR,CACF,CACF,C,gBAEcJ,G,CAGf,GAAIO,mBAAqB,CAAzB,CACA,GAAIC,oBAAqB,CAAzB,C,GAaaC,U,SAAAA,S,YACX,mBAAYC,YAAZ,CAA0B,8CACxB,KAAKC,MAAL,CAAoBJ,mBAApB,CACA,KAAKG,YAAL,CAAoBA,YAApB,CACA,KAAKE,MAAL,CAAoBC,SAApB,CACA,KAAKC,UAAL,CAAoBD,SACrB,C,4EAIS,CACR,GAAI,KAAKD,MAAT,CAAiB,CACf,KAAKA,MAAL,CAAYG,MAAZ,CAAmB,IAAnB,CACD,CACF,C,uCAIQ,CACP,GAAI,CAAC,KAAKD,UAAV,CAAsB,CACpB,GAAI,KAAKJ,YAAT,CAAuB,CACrB,KAAM,IAAIM,MAAJ,CAAU,gDAAV,CACP,CAFD,IAGK,CACH,KAAM,IAAIA,MAAJ,CAAU,kDAAV,CACP,CACF,CAPD,IAQK,CACH,MAAO,MAAKF,UAAL,CAAgB,KAAKJ,YAArB,CACR,CACF,C,kCAIII,U,CAAY,CACf,GAAI,MAAOA,WAAP,GAAuB,UAA3B,CAAuC,CACrC,KAAM,IAAIE,MAAJ,CAAU,4CAAV,CACP,CAED,KAAKF,UAAL,CAAkBA,UAAlB,CAEA,MAAO,KACR,C,4CAGSF,M,CAAQ,CAChB,KAAKA,MAAL,CAAcA,MACf,C,6CAGW,CACV,MAAO,MAAKA,MACb,C,sCAGMK,O,CAASC,G,CAAK,CACnB,GAAI,KAAKR,YAAT,CAAuB,CACrB,KAAKA,YAAL,CAAkBO,OAAlB,EAA6BC,GAC9B,CAFD,IAGK,CACH,KAAKD,OAAL,EAAgBC,GACjB,CACF,C,2BAUGf,W,YACJ,oBAAYgB,GAAZ,CAAiBC,MAAjB,CAAyB,+CACvB,KAAKC,EAAL,CAAgBb,oBAAhB,CACA,KAAKW,GAAL,CAAgBA,GAAhB,CACA,KAAKG,QAAL,CAAgB,EAAhB,CACA,KAAKC,KAAL,CAAgB,EAAhB,CACA,KAAKC,KAAL,CAAgB,EAAhB,CACA,KAAKC,MAAL,CAAgB,EAAhB,CACA,KAAKC,IAAL,CAAgB,EAAhB,CAEA,GAAIP,cAAejB,YAAnB,CAAgC,CAE9B,KAAKiB,GAAL,CAAWA,IAAIQ,OAAJ,CAAYC,WAAZ,EAAX,CACA,KAAKxB,EAAL,CAAWe,GACZ,CAED,KAAKU,cAAL,CAAoBT,MAApB,EAEA,GAAI,KAAKhB,EAAT,CAAa,CAEX,KAAK0B,GAAL,EACD,CACF,C,qFAEa,CACZ,KAAKC,UAAL,CAAkB,KAAlB,CAEA,KAAKF,cAAL,CAAoBG,SAApB,EACA,GAAI,KAAK5B,EAAT,CAAa,CACX,KAAK0B,GAAL,EACD,CACF,C,mDAEc,CACb,GAAI,KAAK1B,EAAT,CAAa,CACX,KAAKA,EAAL,CAAQ6B,SAAR,CAAoB,EACrB,CAED,KAAKF,UAAL,CAAkB,KAAlB,CACA,KAAKT,QAAL,CAAkB,EAAlB,CACA,KAAKY,IAAL,CAAkB,EAAlB,CACA,KAAKV,KAAL,CAAkB,EAAlB,CAEA,KAAKW,WAAL,CAAiBC,KAAjB,CAAuB,IAAvB,CAA6BJ,SAA7B,CACD,C,kCAGIN,I,CAAM,CACT,GAAIW,MAAO,EAAX,CAEA,GAAI,CAACX,IAAL,CAAiB,CAAEA,KAAO,EAAK,CAC/B,GAAI,CAACA,KAAKY,KAAV,CAAiB,CAAEZ,KAAKY,KAAL,CAAa,CAAI,CACpC,GAAIZ,KAAKa,MAAT,CAAiB,CAAEF,MAAQ,IAAIG,MAAJ,CAAWd,KAAKa,MAAL,CAAcb,KAAKY,KAAL,EAAzB,CAAyC,CAEpED,MAAQ,IAAM,KAAKlB,GAAnB,CAEA,GAAII,OAAQ,EAAZ,CATS,gGAUT,4CAAqB,mBAAY,KAAKA,KAAjB,CAArB,kGAA8C,IAArCkB,SAAqC,aAC5ClB,MAAMmB,IAAN,CAAWD,SAAW,GAAX,CAAiB,IAAjB,CAAwB,KAAKE,eAAL,CAAqB,KAAKpB,KAAL,CAAWkB,QAAX,CAArB,CAAxB,CAAqE,IAAhF,CACD,CAZQ,4LAaT,GAAIlB,MAAMqB,MAAV,CAAkB,CAChBP,MAAQ,IAAMd,MAAMsB,IAAN,CAAW,GAAX,CACf,CACD,GAAI,KAAKrB,KAAL,CAAWoB,MAAf,CAAuB,CACrBP,MAAQ,IAAM,KAAKb,KAAL,CAAWqB,IAAX,CAAgB,GAAhB,CACf,CAEDR,MAAQ,GAAR,CAEA,GAAIX,KAAKa,MAAT,CAAiB,CACfF,MAAQ,IACT,CAxBQ,mGA0BT,6CAAiB,KAAKf,QAAtB,uGAAgC,IAAvBwB,KAAuB,cAC9B,GAAIA,KAAKC,IAAL,GAAc,KAAlB,CAAyB,CACvBV,MAAQS,KAAKE,KAAL,CAAWX,IAAX,CAAgBX,IAAhB,CACT,CAFD,IAGK,IAAIoB,KAAKC,IAAL,GAAc,aAAlB,CAAiC,CACpCV,MAAQS,KAAKE,KAAL,CAAWf,SACpB,CAFI,IAGA,IAAIa,KAAKC,IAAL,GAAc,UAAlB,CAA8B,CACjC,GAAIrB,KAAKa,MAAL,EAAeb,KAAKY,KAAxB,CAA+B,CAC7BD,MAAQ,IAAIG,MAAJ,CAAWd,KAAKa,MAAL,CAAcb,KAAKY,KAA9B,CACT,CACDD,MAAQS,KAAKE,KAAb,CACA,GAAItB,KAAKa,MAAL,EAAeb,KAAKY,KAAxB,CAA+B,CAC7BD,MAAQ,IACT,CACF,CARI,IASA,CACHY,QAAQC,GAAR,CAAY,4CAAZ,CAA0DJ,KAAKC,IAA/D,CACD,CACF,CA7CQ,mMA+CT,GAAIrB,KAAKa,MAAL,EAAeb,KAAKY,KAAxB,CAA+B,CAC7BZ,KAAKY,KAAL,GACAD,MAAQ,IAAIG,MAAJ,CAAWd,KAAKa,MAAL,CAAcb,KAAKY,KAA9B,CACT,CAEDD,WAAa,KAAKlB,GAAlB,KACA,GAAIO,KAAKa,MAAT,CAAiB,CACfF,MAAQ,IACT,CACD,MAAOA,KACR,C,gCAGGc,a,CAAe,CACjB,GAAI/C,IAAK,KAAKA,EAAL,EAAWC,SAAS+C,aAAT,CAAuB,KAAKjC,GAA5B,CAApB,CAEA,GAAI,KAAKkC,GAAL,EAAYF,aAAhB,CAA+B,CAC7BA,cAAcG,MAAd,CAAqB,KAAKD,GAA1B,CAA+B,IAA/B,CACD,CAED,GAAI,CAAC,KAAKtB,UAAV,CAAsB,oGACpB,6CAAqB,mBAAY,KAAKR,KAAjB,CAArB,uGAA8C,IAArCkB,SAAqC,cAC5CrC,GAAGmD,YAAH,CAAgBd,QAAhB,CAA0B,KAAKlB,KAAL,CAAWkB,QAAX,CAA1B,CACD,CAHmB,sSAIpB,6CAAqB,KAAKjB,KAA1B,uGAAiC,IAAxBgC,SAAwB,cAC/BpD,GAAGoD,QAAH,EAAe,IAChB,CANmB,sSAOpB,6CAAkB,mBAAY,KAAK/B,MAAjB,CAAlB,uGAA4C,IAAnCgC,MAAmC,cAG1CrD,GAAGsD,gBAAH,CAAoBD,KAApB,CAA2B,KAAKhC,MAAL,CAAYgC,KAAZ,EAAmBE,QAA9C,CACD,CAXmB,mMAYrB,CAED,GAAIC,cAAJ,CACA,IAAK,GAAIC,GAAI,KAAKvC,QAAL,CAAcsB,MAAd,CAAqB,CAAlC,CAAqCiB,GAAK,CAA1C,CAA6CA,GAA7C,CAAkD,CAChD,GAAIf,MAAO,KAAKxB,QAAL,CAAcuC,CAAd,CAAX,CACA,GAAIf,KAAKC,IAAL,GAAc,KAAlB,CAAyB,CACvB,GAAIe,OAAUhB,KAAKE,KAAL,CAAW5C,EAAzB,CACA,GAAI2D,SAAUjB,KAAKE,KAAL,CAAWlB,GAAX,CAAegB,KAAKkB,SAAL,EAAkBb,aAAjC,CAAd,CACAY,QAAQE,GAAR,CAAcnB,KAAKE,KAAL,CAAWiB,GAAzB,CACA,GAAI,CAACH,KAAL,CAAY,CACV,GAAIF,MAAJ,CAAY,CACVxD,GAAG8D,YAAH,CAAgBH,OAAhB,CAAyBH,MAAzB,CACD,CAFD,IAGK,CACHxD,GAAG+B,WAAH,CAAe4B,OAAf,CACD,CACF,CACDH,OAASG,OACV,CAbD,IAcK,IAAIjB,KAAKC,IAAL,GAAc,UAAlB,CAA8B,CACjC,GAAI,CAACD,KAAK1C,EAAV,CAAc,CACZ0C,KAAK1C,EAAL,CAAUC,SAAS8D,cAAT,CAAwBrB,KAAKE,KAA7B,CAAV,CACA,GAAIY,MAAJ,CAAY,CACVxD,GAAG8D,YAAH,CAAgBpB,KAAK1C,EAArB,CAAyBwD,MAAzB,CACD,CAFD,IAGK,CACHxD,GAAG+B,WAAH,CAAeW,KAAK1C,EAApB,CACD,CACF,CACF,CAVI,IAWA,CACH6C,QAAQmB,IAAR,CAAa,2CAAb,CAA0DtB,KAAKC,IAA/D,CACD,CACF,CAED,KAAK3C,EAAL,CAAkBA,EAAlB,CACA,KAAK2B,UAAL,CAAkB,IAAlB,CACA,MAAO3B,GACR,C,wCAGQ,oGAEP,6CAAiB,KAAKkB,QAAtB,uGAAgC,IAAvBwB,KAAuB,cAC9B,KAAKuB,WAAL,CAAiBvB,IAAjB,CACD,CAJM,mMAOP,GAAI,KAAK1C,EAAT,CAAa,CACX,GAAI,KAAKA,EAAL,CAAQkE,UAAZ,CAAwB,CACtB,KAAKlE,EAAL,CAAQkE,UAAR,CAAmBC,WAAnB,CAA+B,KAAKnE,EAApC,CACD,CACF,CAED,MAAO,MAAKA,EAAZ,CAEA,KAAKe,GAAL,CAAgB,WAAhB,CACA,KAAKG,QAAL,CAAgB,EAAhB,CACA,KAAKC,KAAL,CAAgB,EAAhB,CACA,KAAKC,KAAL,CAAgB,EACjB,C,sCAGMwC,S,CAAWQ,W,CAAa,CAG7B,GAAIC,OAAUT,UAAUU,MAAV,EAAd,CAGA,GAAIC,QAAS,GAAIxE,WAAJ,CAAe,KAAf,CAAb,CACAwE,OAAO9C,cAAP,CAAsB,CAAC4C,KAAD,CAAtB,CAA+BT,SAA/B,EAGA,KAAKY,eAAL,CAAqBD,MAArB,CAA6B,IAA7B,CAAmCX,SAAnC,CAA8CQ,WAA9C,CAA2D,CAA3D,EAGA,GAAI,KAAKzC,UAAT,CAAqB,CACnB,KAAKD,GAAL,EACD,CACF,C,wDAMe6C,M,CAAQE,O,CAASb,S,CAAWQ,W,CAAaM,K,CAAO,CAC9D,GAAIC,UAAW,CAAf,CACA,GAAIC,UAAW,CAAf,CAEA,GAAIC,SAAU,qBAAc,EAAd,CAAkBN,MAAlB,CAAd,CAMA,GAAI,CAACE,OAAL,CAAc,CACZ,GAAIL,aAAe,KAAK9C,IAAL,CAAU8C,WAAzB,EAAwC,KAAKrD,GAAL,GAAawD,OAAOxD,GAAhE,CAAqE,CACnE,MAAO,KACR,CAGD,KAAKO,IAAL,CAAYiD,OAAOjD,IAAnB,CANY,mGASZ,6CAAqB,mBAAY,KAAKH,KAAjB,CAArB,uGAA8C,IAArCkB,SAAqC,cAC5C,GAAI,CAACkC,OAAOpD,KAAP,CAAakB,QAAb,CAAL,CAA6B,CAC3B,MAAO,MAAKlB,KAAL,CAAWkB,QAAX,CAAP,CACA,GAAI,KAAKV,UAAT,CAAqB,CACnB,KAAK3B,EAAL,CAAQ8E,eAAR,CAAwBzC,QAAxB,CACD,CACF,CALD,IAMK,IAAIkC,OAAOpD,KAAP,CAAakB,QAAb,IAA2B,KAAKlB,KAAL,CAAWkB,QAAX,CAA/B,CAAqD,CACxD,KAAKlB,KAAL,CAAWkB,QAAX,EAAuBkC,OAAOpD,KAAP,CAAakB,QAAb,CAAvB,CACA,GAAI,KAAKV,UAAT,CAAqB,CACnB,KAAK3B,EAAL,CAAQmD,YAAR,CAAqBd,QAArB,CAA+BkC,OAAOpD,KAAP,CAAakB,QAAb,CAA/B,CACD,CACF,CACF,CAtBW,sSAuBZ,6CAAqB,mBAAYkC,OAAOpD,KAAnB,CAArB,uGAAgD,IAAvCkB,UAAuC,cAC9C,GAAI,CAAC,KAAKlB,KAAL,CAAWkB,SAAX,CAAL,CAA2B,CACzB,KAAKlB,KAAL,CAAWkB,SAAX,EAAuBkC,OAAOpD,KAAP,CAAakB,SAAb,CAAvB,CACA,GAAI,KAAKV,UAAT,CAAqB,CACnB,KAAK3B,EAAL,CAAQmD,YAAR,CAAqBd,SAArB,CAA+BkC,OAAOpD,KAAP,CAAakB,SAAb,CAA/B,CACD,CACF,CACF,CA9BW,mMAgCZ,GAAI,KAAKjB,KAAL,CAAWoB,MAAX,EAAqB+B,OAAOnD,KAAP,CAAaoB,MAAtC,CAA8C,CAC5C,GAAIuC,UAAW,KAAf,CAKA,GAAI,KAAK3D,KAAL,CAAWoB,MAAX,EAAqB+B,OAAOnD,KAAP,CAAaoB,MAAtC,CAA8C,CAC5CuC,SAAW,IACZ,CAFD,IAGK,CACH,IAAK,GAAItB,GAAI,CAAb,CAAgBA,EAAI,KAAKrC,KAAL,CAAWoB,MAA/B,CAAuCiB,GAAvC,CAA4C,CAC1C,GAAI,KAAKrC,KAAL,CAAWqC,CAAX,IAAkBc,OAAOnD,KAAP,CAAaqC,CAAb,CAAtB,CAAuC,CACrCsB,SAAW,IAAX,CACA,KACD,CACF,CACF,CAED,GAAIA,QAAJ,CAAc,CACZ,GAAI,KAAKpD,UAAT,CAAqB,oGACnB,6CAAiB,KAAKP,KAAtB,uGAA6B,IAApB4D,KAAoB,cAC3B,MAAO,MAAKhF,EAAL,CAAQgF,IAAR,CACR,CAHkB,ySAInB,8CAAiBT,OAAOnD,KAAxB,4GAA+B,IAAtB4D,MAAsB,eAC7B,KAAKhF,EAAL,CAAQgF,KAAR,EAAgB,IACjB,CANkB,0MAOpB,CACD,KAAK5D,KAAL,CAAamD,OAAOnD,KACrB,CACF,CA7DW,sGAgEZ,8CAAsB,mBAAY,KAAKC,MAAjB,CAAtB,4GAAgD,IAAvC4D,UAAuC,eAC9C,GAAI,CAACV,OAAOlD,MAAP,CAAc4D,SAAd,CAAL,CAA+B,CAC7B,MAAO,MAAK5D,MAAL,CAAY4D,SAAZ,CAAP,CACA,GAAI,KAAKtD,UAAT,CAAqB,CACnB,KAAK3B,EAAL,CAAQkF,mBAAR,CAA4BD,SAA5B,CAAuC,KAAK5D,MAAL,CAAY4D,SAAZ,EAAuB1B,QAA9D,CACD,CACF,CALD,IAMK,IAAIgB,OAAOlD,MAAP,CAAc4D,SAAd,EAAyB1B,QAAzB,GAAsC,KAAKlC,MAAL,CAAY4D,SAAZ,EAAuB1B,QAAjE,CAA2E,CAC9E,GAAI,KAAK5B,UAAT,CAAqB,CACnB,KAAK3B,EAAL,CAAQkF,mBAAR,CAA4BD,SAA5B,CAAuC,KAAK5D,MAAL,CAAY4D,SAAZ,EAAuB1B,QAA9D,EACA,KAAKvD,EAAL,CAAQsD,gBAAR,CAAyB2B,SAAzB,CAAoCV,OAAOlD,MAAP,CAAc4D,SAAd,EAAyB1B,QAA7D,CACD,CACD,KAAKlC,MAAL,CAAY4D,SAAZ,EAAyBV,OAAOlD,MAAP,CAAc4D,SAAd,CAC1B,CACF,CA9EW,gTA+EZ,8CAAsB,mBAAYV,OAAOlD,MAAnB,CAAtB,4GAAkD,IAAzC4D,WAAyC,eAChD,GAAI,CAAC,KAAK5D,MAAL,CAAY4D,UAAZ,CAAL,CAA6B,CAC3B,KAAK5D,MAAL,CAAY4D,UAAZ,EAAyBV,OAAOlD,MAAP,CAAc4D,UAAd,CAAzB,CACA,GAAI,KAAKtD,UAAT,CAAqB,CACnB,KAAK3B,EAAL,CAAQsD,gBAAR,CAAyB2B,UAAzB,CAAoCV,OAAOlD,MAAP,CAAc4D,UAAd,EAAyB1B,QAA7D,CACD,CACF,CACF,CAtFW,0MAuFb,CAED,GAAI,CAACa,WAAD,EAAgB,CAAC,KAAK9C,IAAL,CAAU8C,WAA/B,CAA4C,CAC1C,MAAO,IAAP,CAAa,CACX,GAAIe,UAAU,KAAKjE,QAAL,CAAcyD,QAAd,CAAd,CACA,GAAIS,SAAUb,OAAOrD,QAAP,CAAgB0D,QAAhB,CAAd,CAEA,GAAI,CAACO,QAAD,EAAY,CAACC,OAAjB,CAA0B,CACxB,KACD,CAED,GAAIxB,WAAauB,SAAQvB,SAAR,CAAkBrD,MAAlB,GAA6BqD,UAAUrD,MAAxD,CAAgE,CAC9DoE,WACA,QACD,CAED,GAAIQ,SAAQxC,IAAR,GAAiByC,QAAQzC,IAA7B,CAAmC,CACjC,KACD,CAED,GAAIwC,SAAQxC,IAAR,GAAiB,KAArB,CAA4B,CAE1B,GAAI0C,WAAYF,SAAQvC,KAAR,CAAc4B,eAAd,CAA8BY,QAAQxC,KAAtC,CAA6C,KAA7C,CAAoDnC,SAApD,CAA+DA,SAA/D,CAA0EiE,MAAM,CAAhF,CAAhB,CACA,GAAIW,SAAJ,CAAe,CACb,KACD,CACF,CAND,IAOK,IAAIF,SAAQxC,IAAR,GAAiB,UAAjB,EAA+BwC,SAAQvC,KAAR,GAAkBwC,QAAQxC,KAA7D,CAAoE,CACvE,GAAIuC,SAAQnF,EAAZ,CAAgB,CACdmF,SAAQnF,EAAR,CAAWsF,WAAX,CAAyBF,QAAQxC,KAClC,CACDuC,SAAQvC,KAAR,CAAgBwC,QAAQxC,KACzB,CAED+B,WACAC,UACD,CACF,CAGD,GAAIW,eAAgBZ,QAApB,CACA,GAAIQ,SAAgB,KAAKjE,QAAL,CAAcyD,QAAd,CAApB,CAEA,MAAOQ,OAAP,CAAgB,CACd,GAAIvB,WAAauB,QAAQvB,SAAR,CAAkBrD,MAAlB,GAA6BqD,UAAUrD,MAAxD,CAAgE,CAC9D,KACD,CAED,KAAK0D,WAAL,CAAiBkB,OAAjB,EACAR,WACAQ,QAAU,KAAKjE,QAAL,CAAcyD,QAAd,CACX,CAED,KAAKzD,QAAL,CAAcsE,MAAd,CAAqBD,aAArB,CAAoCZ,SAAWY,aAA/C,EAEA,GAAIhB,OAAOrD,QAAP,CAAgB0D,QAAhB,CAAJ,CAA+B,eAE7B,GAAIa,UAAWlB,OAAOrD,QAAP,CAAgBsE,MAAhB,CAAuBZ,QAAvB,CAAiCL,OAAOrD,QAAP,CAAgBsB,MAAhB,CAAyBoC,QAA1D,CAAf,CAF6B,sGAI7B,8CAAoBa,QAApB,4GAA8B,IAArBL,SAAqB,eAC5B,GAAIA,SAAQxB,SAAZ,CAAuB,CACrBwB,SAAQxB,SAAR,CAAkB8B,SAAlB,CAA4B,IAA5B,CACD,CACF,CAR4B,0MAS7B,gBAAKxE,QAAL,EAAcsE,MAAd,kBAAqBD,aAArB,CAAoC,CAApC,yCAA0CE,QAA1C,GACD,CAGD,MAAO,MAER,C,gDAEWE,Y,CAAc,CACxB,GAAIA,aAAahD,IAAb,GAAsB,KAA1B,CAAiC,CAC/BgD,aAAa/C,KAAb,CAAmBgD,MAAnB,EACD,CAFD,IAGK,IAAID,aAAahD,IAAb,GAAsB,UAA1B,CAAsC,CACzC,GAAIgD,aAAa3F,EAAb,EAAmB2F,aAAa3F,EAAb,CAAgBkE,UAAvC,CAAmD,CAEjDyB,aAAa3F,EAAb,CAAgBkE,UAAhB,CAA2BC,WAA3B,CAAuCwB,aAAa3F,EAApD,EACA,MAAO2F,cAAa3F,EACrB,CACF,CANI,IAOA,CACH6C,QAAQmB,IAAR,CAAa,yCAAb,CAAwD2B,aAAahD,IAArE,CACD,CACF,C,sDAQc3B,M,CAAQ4C,S,CAAW,CAChC5C,OAASpB,IAAIiG,QAAJ,CAAa7D,KAAb,CAAmB,IAAnB,CAAyBhB,MAAzB,CAAT,CACA,GAAI,MAAOA,OAAP,GAAkB,WAAtB,CAAmC,CACjCA,OAAS,EACV,CAJ+B,sGAKhC,8CAAkBA,MAAlB,4GAA0B,IAAjB8E,MAAiB,eACxB,GAAInD,YAAcmD,MAAd,gDAAcA,KAAd,CAAJ,CAEA,GAAInD,OAAS,QAAT,EAAqBA,OAAS,QAAlC,CAA4C,CAC1C,KAAKzB,QAAL,CAAcoB,IAAd,CAAmB,CAACK,KAAM,UAAP,CAAmBC,MAAOkD,KAA1B,CAAiClC,UAAWA,SAA5C,CAAnB,CACD,CAFD,IAGK,IAAIjB,OAAS,SAAb,CAAwB,CAC3B,KAAKzB,QAAL,CAAcoB,IAAd,CAAmB,CAACK,KAAM,UAAP,CAAmBC,MAAOkD,MAAMC,QAAN,EAA1B,CAA4CnC,UAAWA,SAAvD,CAAnB,CACD,CAFI,IAGA,IAAIkC,gBAAiBzF,UAArB,CAAgC,CACnC,GAAI,CAACyF,MAAME,SAAN,EAAL,CAAwB,CACtBF,MAAMJ,SAAN,CAAgB,IAAhB,CACD,CAED,GAAIrB,OAAQyB,MAAMxB,MAAN,EAAZ,CACA,KAAK7C,cAAL,CAAoB,CAAC4C,KAAD,CAApB,CAA6ByB,KAA7B,CACD,CAPI,IAQA,IAAIA,gBAAiB/F,WAArB,CAAiC,CACpC,KAAKmB,QAAL,CAAcoB,IAAd,CAAmB,CAACK,KAAM,KAAP,CAAcC,MAAOkD,KAArB,CAA4BlC,UAAWA,SAAvC,CAAnB,CACD,CAFI,IAGA,IAAI,MAAO9D,YAAP,GAAuB,WAAvB,EAAsCgG,gBAAiBhG,YAA3D,CAAwE,CAC3E,KAAKoB,QAAL,CAAcoB,IAAd,CAAmB,CAACK,KAAM,KAAP,CAAcC,MAAO,GAAI7C,WAAJ,CAAe+F,KAAf,CAArB,CAA4ClC,UAAWA,SAAvD,CAAnB,CACD,CAFI,IAGA,IAAIjB,OAAS,QAAb,CAAuB,uGAC1B,8CAAiB,mBAAYmD,KAAZ,CAAjB,4GAAqC,IAA5BG,KAA4B,eACnC,GAAI,MAAOH,OAAMG,IAAN,CAAP,GAAwB,WAA5B,CAAyC,CACvCH,MAAMG,IAAN,EAAc,EACf,CACD,GAAIA,OAAS,YAAT,EAAyBH,MAAMI,UAAN,WAA4BC,OAAzD,CAAiE,CAC/D,KAAK7E,IAAL,CAAYwE,MAAMI,UACnB,CAFD,IAGK,IAAID,OAAS,YAAT,EAAyBH,MAAMM,UAAN,WAA4BC,MAAzD,CAAgE,uGACnE,8CAAiBP,MAAMM,UAAvB,4GAAmC,IAA1BpB,KAA0B,eACjC,KAAK5D,KAAL,CAAWkB,IAAX,CAAgB0C,IAAhB,CACD,CAHkE,0MAIpE,CAJI,IAKA,IAAIiB,OAAS,QAAT,EAAqB,qBAAOH,MAAMzE,MAAb,IAAwB,QAAjD,CAA2D,uGAC9D,8CAAkB,mBAAYyE,MAAMzE,MAAlB,CAAlB,4GAA6C,IAApCgC,MAAoC,eAC3C,GAAIyC,MAAMzE,MAAN,CAAagC,KAAb,WAA+BiD,SAAnC,CAA6C,CAC3C,KAAKjF,MAAL,CAAYgC,KAAZ,EAAqB,CAACE,SAAUuC,MAAMzE,MAAN,CAAagC,KAAb,CAAX,CACtB,CAFD,IAGK,CACH,KAAKhC,MAAL,CAAYgC,KAAZ,EAAqByC,MAAMzE,MAAN,CAAagC,KAAb,CACtB,CACF,CAR6D,0MAS/D,CATI,IAUA,IAAI4C,OAAS,KAAb,CAAoB,CACvB,KAAKhD,GAAL,CAAiB6C,MAAMG,IAAN,CAAjB,CACA,KAAK9E,KAAL,CAAW8B,GAAX,CAAiB6C,MAAMG,IAAN,CAClB,CAHI,IAIA,IAAIA,OAAS,IAAb,CAAmB,CAGtB,GAAI,KAAK9E,KAAL,CAAW,OAAX,CAAJ,CAAyB,CACvB,KAAKA,KAAL,CAAW,OAAX,GAAuB,IAAM2E,MAAMG,IAAN,CAC9B,CAFD,IAGK,CACH,KAAK9E,KAAL,CAAW,OAAX,EAAsB2E,MAAMG,IAAN,CACvB,CACF,CATI,IAUA,CACH,KAAK9E,KAAL,CAAW8E,IAAX,EAAmBH,MAAMG,IAAN,CACpB,CACF,CAxCyB,0MAyC3B,CAzCI,IA0CA,IAAItD,OAAS,WAAb,CAA0B,CAE9B,CAFI,IAGA,CACHE,QAAQC,GAAR,CAAY,qCAAZ,CAAmDH,IAAnD,CACD,CACF,CA5E+B,0MA6EjC,C,wDAIeC,K,CAAO,CACrB,MAAOA,OAAM2D,OAAN,CAAgB3D,MAAM2D,OAAN,CAAc,GAAd,CAAmB,IAAnB,CAAhB,CAA2C3D,KACnD,C,yBAKHhD,IAAI4G,EAAJ,CAAS5G,IAAI6G,SAAJ,CAAgB,EAAzB,CAIA7G,IAAI8G,MAAJ,CAAa9G,IAAI4G,EAAJ,CAAOE,MAAP,CAAgB,UAAW,CACtC,GAAIC,QAAS,IAAb,CACA,GAAInE,QAASZ,UAAUY,MAAvB,CAEA,IAAK,GAAIiB,GAAI,CAAb,CAAgBA,EAAIjB,MAApB,CAA4BiB,GAA5B,CAAiC,CAC/B,GAAImD,eAAJ,CACA,GAAI,CAACA,QAAUhF,UAAU6B,CAAV,CAAX,IAA6B,IAAjC,CAAuC,CACrC,IAAK,GAAIwC,KAAT,GAAiBW,QAAjB,CAA0B,CACxB,GAAIC,MAAOD,QAAQX,IAAR,CAAX,CAGA,GAAIU,SAAWE,IAAf,CAAqB,CACnB,QACD,CAED,GAAIA,OAASpG,SAAb,CAAwB,CACtBkG,OAAOV,IAAP,EAAeY,IAChB,CACF,CACF,CACF,CAGD,MAAOF,OACR,CAxBD,CA2BA/G,IAAI8G,MAAJ,CAAW,CACTI,UAAW,GADF,CAETC,KAAM,CACJ,GADI,CACC,MADD,CACS,SADT,CACoB,MADpB,CAC4B,SAD5B,CACuC,OADvC,CACgD,OADhD,CACyD,GADzD,CAC8D,MAD9D,CAEJ,KAFI,CAEG,KAFH,CAEU,YAFV,CAEwB,MAFxB,CAEgC,IAFhC,CAEsC,QAFtC,CAEgD,QAFhD,CAE0D,SAF1D,CAGJ,MAHI,CAGI,MAHJ,CAGY,KAHZ,CAGmB,UAHnB,CAG+B,SAH/B,CAG0C,MAH1C,CAGkD,UAHlD,CAG8D,IAH9D,CAIJ,KAJI,CAIG,SAJH,CAIc,KAJd,CAIqB,KAJrB,CAI4B,IAJ5B,CAIkC,IAJlC,CAIwC,IAJxC,CAI8C,OAJ9C,CAIuD,UAJvD,CAKJ,YALI,CAKU,QALV,CAKoB,QALpB,CAK8B,MAL9B,CAKsC,IALtC,CAK4C,IAL5C,CAKkD,IALlD,CAKwD,IALxD,CAK8D,IAL9D,CAMJ,IANI,CAME,MANF,CAMU,QANV,CAMoB,QANpB,CAM8B,IAN9B,CAMoC,MANpC,CAM4C,GAN5C,CAMiD,QANjD,CAM2D,KAN3D,CAMkE,OANlE,CAOJ,KAPI,CAOG,KAPH,CAOU,QAPV,CAOoB,OAPpB,CAO6B,QAP7B,CAOuC,IAPvC,CAO6C,MAP7C,CAOqD,MAPrD,CAO6D,KAP7D,CAOoE,MAPpE,CAO4E,MAP5E,CAQJ,MARI,CAQI,MARJ,CAQY,OARZ,CAQqB,KARrB,CAQ4B,UAR5B,CAQwC,QARxC,CAQkD,IARlD,CAQwD,UARxD,CAQoE,QARpE,CASJ,QATI,CASM,GATN,CASW,OATX,CASoB,KATpB,CAS2B,UAT3B,CASuC,GATvC,CAS4C,IAT5C,CASkD,IATlD,CASwD,MATxD,CASgE,GAThE,CAUJ,MAVI,CAUI,QAVJ,CAUc,SAVd,CAUyB,QAVzB,CAUmC,OAVnC,CAU4C,QAV5C,CAUsD,MAVtD,CAU8D,QAV9D,CAWJ,OAXI,CAWK,KAXL,CAWY,SAXZ,CAWuB,KAXvB,CAW8B,KAX9B,CAWqC,OAXrC,CAW8C,OAX9C,CAWuD,IAXvD,CAW6D,UAX7D,CAYJ,OAZI,CAYK,IAZL,CAYW,OAZX,CAYoB,MAZpB,CAY4B,OAZ5B,CAYqC,IAZrC,CAY2C,OAZ3C,CAYoD,GAZpD,CAYyD,IAZzD,CAY+D,KAZ/D,CAaJ,OAbI,CAaK,KAbL,CAFG,CAsBTC,kBAAmB,4BAAW,CAC5B,GAAIC,OAAQrH,IAAIiG,QAAJ,CAAa7D,KAAb,CAAmB,IAAnB,CAAyBJ,SAAzB,CAAZ,CAD4B,oIAGnBqE,KAHmB,eAI1B,GAAIiB,UAAWtH,IAAIkH,SAAJ,CAAgBb,IAA/B,CACArG,IAAIsH,QAAJ,EAAgB,UAAW,CACzB,GAAIC,MAAOvH,IAAIiG,QAAJ,CAAa7D,KAAb,CAAmB,IAAnB,CAAyBJ,SAAzB,CAAX,CACA,MAAQ,IAAI7B,WAAJ,CAAekG,IAAf,CAAqBkB,IAArB,CACT,CARyB,EAG5B,8CAAiBF,KAAjB,4GAAwB,QAMvB,CAT2B,0MAU7B,CAhCQ,CAmCTG,KAAM,eAAW,CACfxH,IAAIoH,iBAAJ,CAAsBpH,IAAImH,IAA1B,CACD,CArCQ,CAyCTM,OAAQ,gBAASC,GAAT,CAAc,CACpB,GAAI,OAAOA,IAAP,gDAAOA,GAAP,IAAe,QAAnB,CAA6B,CAC3B,KAAM,IAAI1G,MAAJ,CAAU,yCAAV,CACP,CACD,MAAO0G,KAAIC,IAAJ,CAAW,GAAIlH,UAAJ,CAAciH,GAAd,CACnB,CA9CQ,CAkDTE,WAAY,oBAASC,MAAT,CAAiB,CAC3B7H,IAAI8H,MAAJ,CAAsB,IAAtB,CACA9H,IAAI+H,eAAJ,CAAsBF,QAAU7H,IAAIkH,SAApC,CAF2B,sIAGlB/F,IAHkB,eAIzB,GAAIkF,MAAOrG,IAAI+H,eAAJ,CAAsB5G,GAAjC,CACA,GAAI6G,GAAI,MAAOF,OAAP,GAAkB,WAAlB,CAAgCA,MAAhC,CAAyCG,MAAjD,CACAD,EAAE3B,IAAF,EAAU,UAAW,CACnB,MAAOrG,KAAIqG,IAAJ,EAAUjE,KAAV,CAAgB,IAAhB,CAAsBJ,SAAtB,CACR,CARwB,EAG3B,8CAAgBhC,IAAImH,IAApB,4GAA0B,SAMzB,CAT0B,0MAU5B,CA5DQ,CA8DTlB,SAAU,mBAAW,CACnB,GAAIiC,MAAO,EAAX,CACA,IAAK,GAAIrE,GAAI,CAAb,CAAgBA,EAAI7B,UAAUY,MAA9B,CAAsCiB,GAAtC,CAA2C,CACzC,GAAI7B,UAAU6B,CAAV,WAAwB4C,MAA5B,CAAmC,CACjCyB,KAAKxF,IAAL,CAAUN,KAAV,CAAgB8F,IAAhB,CAAsBlI,IAAIiG,QAAJ,CAAa7D,KAAb,CAAmB,IAAnB,CAAyBJ,UAAU6B,CAAV,CAAzB,CAAtB,CACD,CAFD,IAGK,IAAI7B,UAAU6B,CAAV,WAAwB6C,SAA5B,CAAsC,CACzC,GAAIyB,QAASnG,UAAU6B,CAAV,GAAb,CACA,GAAIsE,iBAAkB1B,MAAtB,CAA6B,CAC3ByB,KAAKxF,IAAL,CAAUN,KAAV,CAAgB8F,IAAhB,CAAsBlI,IAAIiG,QAAJ,CAAa7D,KAAb,CAAmB,IAAnB,CAAyB+F,MAAzB,CAAtB,CACD,CAFD,IAGK,CACHD,KAAKxF,IAAL,CAAUyF,MAAV,CACD,CACF,CARI,IASA,CACHD,KAAKxF,IAAL,CAAUV,UAAU6B,CAAV,CAAV,CACD,CACF,CACD,MAAOqE,KACR,CAlFQ,CAAX,EAsFAlI,IAAIwH,IAAJ","file":"jayesstee.js","sourcesContent":["// Jayesstee (JST) is a pure javascript HTML templating\n// library, that lets you build HTML (and insert into the DOM)\n// using functional javascript\n//\n// Copyright 2018 Edward Funnekotter All rights reserved\n\nexport function jst(selectorOrElement) {\n  if (selectorOrElement instanceof HTMLElement) {\n    return new JstElement(selectorOrElement);\n  }\n  else {\n    let el = document.querySelector(selectorOrElement);\n    if (!el) {\n      return new JstElement();\n    }\n    else {\n      return new JstElement(el);\n    }\n  }\n}\n\nexport default jst;\n\n// Some global unique identifiers\nlet globalJstObjectId  = 1;\nlet globalJstElementId = 1;\n\n// JstObject Class\n//\n// This class is a base class for all classes that are\n// renderable within jayesstee. For a user-defined class to\n// be successfully redered, it must extend this class and\n// implement the render() method\n//\n// It can also be used as a companion object for generic\n// objects. Calling jst.object(someObj) will return one of these\n// objects that is linked to someObj (someObj.$jst is this object and\n// this.companionObj is the passed in object).\nexport class JstObject {\n  constructor(companionObj) {\n    this._jstId       = globalJstObjectId++;\n    this.companionObj = companionObj;\n    this.parent       = undefined;\n    this.renderFunc   = undefined;\n  }\n\n  // Refresh the instantiation of this object\n  // Should be called after dependent data is changed\n  refresh() {\n    if (this.parent) {\n      this.parent.update(this);\n    }\n  }\n\n  // Called automatically on instantiation or refresh\n  // This must be overrided in classes inheriting from JstObject\n  render() {\n    if (!this.renderFunc) {\n      if (this.companionObj) {\n        throw(new Error(\"You must define a render function with .fill()\"));\n      }\n      else {\n        throw(new Error(\"You must override render() in descendant classes\"));\n      }\n    }\n    else {\n      return this.renderFunc(this.companionObj);\n    }\n  }\n\n  // Used to specify the render behaviour for a generic object that\n  // has been linked through jst.object(<object>)\n  fill(renderFunc) {\n    if (typeof(renderFunc) !== \"function\") {\n      throw(new Error(\".fill() expects a function to be passed in\"));\n    }\n\n    this.renderFunc = renderFunc;\n    \n    return this;\n  }\n\n  // Internal function to set the parent of this object\n  setParent(parent) {\n    this.parent = parent;\n  }\n\n  // Internal function to get the parent\n  getParent() {\n    return this.parent;\n  }\n\n  // Internal function to record the reference name\n  setRef(refName, val) {\n    if (this.companionObj) {\n      this.companionObj[refName] = val;\n    }\n    else {\n      this[refName] = val;\n    }\n  }\n  \n}\n\n\n// JstElement Class\n//\n// This class represents an HTML element. On creation\n// it is just a scaffold that can be either inserted into\n// the DOM (in a browser) or serialized into HTML.\nclass JstElement {\n  constructor(tag, params) {\n    this.id       = globalJstElementId++;\n    this.tag      = tag;\n    this.contents = [];\n    this.attrs    = {};\n    this.props    = [];\n    this.events   = {};\n    this.opts     = {};\n\n    if (tag instanceof HTMLElement) {\n      // Wrapping an element with a JstElement\n      this.tag = tag.tagName.toLowerCase();\n      this.el  = tag;\n    }\n\n    this._processParams(params);\n\n    if (this.el) {\n      // If we have a real element, put all the content into it\n      this.dom();\n    }\n  }\n\n  appendChild() {\n    this.isDomified = false;\n\n    this._processParams(arguments);\n    if (this.el) {\n      this.dom();\n    }\n  }\n\n  replaceChild() {\n    if (this.el) {\n      this.el.innerHTML = \"\";\n    }\n\n    this.isDomified = false;\n    this.contents   = [];\n    this.atts       = [];\n    this.props      = [];\n\n    this.appendChild.apply(this, arguments);\n  }\n\n  // Return HTML\n  html(opts) {\n    let html = \"\";\n\n    if (!opts)       { opts = {}; }\n    if (!opts.depth) { opts.depth = 0; }\n    if (opts.indent) { html += \" \".repeat(opts.indent * opts.depth++); }\n\n    html += \"<\" + this.tag;\n\n    let attrs = [];\n    for (let attrName of Object.keys(this.attrs)) {\n      attrs.push(attrName + \"=\" + \"\\\"\" + this._quoteAttrValue(this.attrs[attrName]) + \"\\\"\");\n    }\n    if (attrs.length) {\n      html += \" \" + attrs.join(\" \");\n    }\n    if (this.props.length) {\n      html += \" \" + this.props.join(\" \");\n    }\n\n    html += \">\";\n\n    if (opts.indent) {\n      html += \"\\n\";\n    }\n\n    for (let item of this.contents) {\n      if (item.type === \"jst\") {\n        html += item.value.html(opts);\n      }\n      else if (item.type === \"HTMLElement\") {\n        html += item.value.innerHTML;\n      }\n      else if (item.type === \"textnode\") {\n        if (opts.indent && opts.depth) {\n          html += \" \".repeat(opts.indent * opts.depth);\n        }\n        html += item.value;\n        if (opts.indent && opts.depth) {\n          html += \"\\n\";\n        }\n      }\n      else {\n        console.log(\"Unexpected content type while serializing:\", item.type);\n      }\n    }\n\n    if (opts.indent && opts.depth) {\n      opts.depth--;\n      html += \" \".repeat(opts.indent * opts.depth);\n    }\n\n    html += `</${this.tag}>`;\n    if (opts.indent) {\n      html += \"\\n\";\n    }\n    return html;\n  }\n\n  // Instantiate into the DOM and return the HTMLElement\n  dom(lastJstObject) {\n    let el = this.el || document.createElement(this.tag);\n\n    if (this.ref && lastJstObject) {\n      lastJstObject.setRef(this.ref, this);\n    }\n\n    if (!this.isDomified) {\n      for (let attrName of Object.keys(this.attrs)) {\n        el.setAttribute(attrName, this.attrs[attrName]);\n      }\n      for (let propName of this.props) {\n        el[propName] = true;\n      }\n      for (let event of Object.keys(this.events)) {\n        // TODO: Add support for options - note that this will require\n        //       some detection of options support in the browser...\n        el.addEventListener(event, this.events[event].listener);\n      }\n    }\n\n    let nextEl;\n    for (let i = this.contents.length-1; i >= 0; i--) {\n      let item = this.contents[i];\n      if (item.type === \"jst\") {\n        let hasEl   = item.value.el;\n        let childEl = item.value.dom(item.jstObject || lastJstObject);\n        childEl.aId = item.value.aId;\n        if (!hasEl) {\n          if (nextEl) {\n            el.insertBefore(childEl, nextEl);\n          }\n          else {\n            el.appendChild(childEl);\n          }\n        }\n        nextEl = childEl;\n      }\n      else if (item.type === \"textnode\") {\n        if (!item.el) {\n          item.el = document.createTextNode(item.value);\n          if (nextEl) {\n            el.insertBefore(item.el, nextEl);\n          }\n          else {\n            el.appendChild(item.el);\n          }\n        }\n      }\n      else {\n        console.warn(\"Unexpected content type while dominating:\", item.type);\n      }\n    }\n\n    this.el         = el;\n    this.isDomified = true;\n    return el;\n  }\n\n  // Delete this element and remove from the DOM if there\n  delete() {\n    // Remove all items associated with this JstElement\n    for (let item of this.contents) {\n      this._deleteItem(item);\n    }\n\n    // Delete this element, if present\n    if (this.el) {\n      if (this.el.parentNode) {\n        this.el.parentNode.removeChild(this.el);\n      }\n    }\n\n    delete this.el;\n\n    this.tag      = \"-deleted-\";\n    this.contents = [];\n    this.attrs    = {};\n    this.props    = [];\n  }\n\n  // Internal function that will update this element and all below it\n  update(jstObject, forceUpdate) {\n\n    // Create a new JST tree that will be compared against the existing one\n    let items   = jstObject.render();\n\n    // newJst will contain the new updated tree\n    let newJst = new JstElement(\"div\");\n    newJst._processParams([items], jstObject);\n\n    // Compare with the existing tree to find what needs to change\n    this._compareAndCopy(newJst, true, jstObject, forceUpdate, 0);\n\n    // If we were already domified, then redo it for the new elements\n    if (this.isDomified) {\n      this.dom();\n    }\n  }\n\n  // Takes a new Jst tree and will do a full comparison to find the differences\n  // which will then be copied into the real tree in preparation for changing\n  // the DOM \n  // Returns true if upper layer needs to copy new Jst. False otherwise\n  _compareAndCopy(newJst, topNode, jstObject, forceUpdate, level) {\n    let oldIndex = 0;\n    let newIndex = 0;\n\n    let copyJst = Object.assign({}, newJst);\n\n    // console.log(\"CAC>\" + \" \".repeat(level*2), this.tag + this.aId, newJst.tag+newJst.aId);\n    \n    // First check the attributes, props and events\n    // But only if we aren't the topNode\n    if (!topNode) {\n      if (forceUpdate || this.opts.forceUpdate || this.tag !== newJst.tag) {\n        return true;\n      }\n\n      // Blindly copy the JST options\n      this.opts = newJst.opts;\n      \n      // Just fix all the attributes inline\n      for (let attrName of Object.keys(this.attrs)) {\n        if (!newJst.attrs[attrName]) {\n          delete this.attrs[attrName];\n          if (this.isDomified) {\n            this.el.removeAttribute(attrName);\n          }\n        }\n        else if (newJst.attrs[attrName] !== this.attrs[attrName]) {\n          this.attrs[attrName] = newJst.attrs[attrName];\n          if (this.isDomified) {\n            this.el.setAttribute(attrName, newJst.attrs[attrName]);\n          }\n        }\n      }\n      for (let attrName of Object.keys(newJst.attrs)) {\n        if (!this.attrs[attrName]) {\n          this.attrs[attrName] = newJst.attrs[attrName];\n          if (this.isDomified) {\n            this.el.setAttribute(attrName, newJst.attrs[attrName]);\n          }\n        }\n      }\n\n      if (this.props.length || newJst.props.length) {\n        let fixProps = false;\n        \n        // Just compare them in order - if they happen to be the same,\n        // but in a different order, we will do a bit more work than necessary\n        // but it should be very unlikely that that would happen\n        if (this.props.length != newJst.props.length) {\n          fixProps = true;\n        }\n        else {\n          for (let i = 0; i < this.props.length; i++) {\n            if (this.props[i] !== newJst.props[i]) {\n              fixProps = true;\n              break;\n            }\n          }\n        }\n        \n        if (fixProps) {\n          if (this.isDomified) {\n            for (let prop of this.props) {\n              delete this.el[prop];\n            }\n            for (let prop of newJst.props) {\n              this.el[prop] = true;\n            }\n          }\n          this.props = newJst.props;\n        }\n      }\n      \n      // Fix all the events\n      for (let eventName of Object.keys(this.events)) {\n        if (!newJst.events[eventName]) {\n          delete this.events[eventName];\n          if (this.isDomified) {\n            this.el.removeEventListener(eventName, this.events[eventName].listener);\n          }\n        }\n        else if (newJst.events[eventName].listener !== this.events[eventName].listener) {\n          if (this.isDomified) {\n            this.el.removeEventListener(eventName, this.events[eventName].listener);\n            this.el.addEventListener(eventName, newJst.events[eventName].listener);\n          }\n          this.events[eventName] = newJst.events[eventName];\n        }\n      }\n      for (let eventName of Object.keys(newJst.events)) {\n        if (!this.events[eventName]) {\n          this.events[eventName] = newJst.events[eventName];\n          if (this.isDomified) {\n            this.el.addEventListener(eventName, newJst.events[eventName].listener);\n          }\n        }\n      }\n    }\n\n    if (!forceUpdate && !this.opts.forceUpdate) {\n      while (true) {\n        let oldItem = this.contents[oldIndex];\n        let newItem = newJst.contents[newIndex];\n\n        if (!oldItem || !newItem) {\n          break;\n        }\n\n        if (jstObject && oldItem.jstObject._jstId !== jstObject._jstId) {\n          oldIndex++;\n          continue;\n        }\n\n        if (oldItem.type !== newItem.type) {\n          break;\n        }\n\n        if (oldItem.type === \"jst\") {\n          // If the tags are the same, then we must descend and compare\n          let doReplace = oldItem.value._compareAndCopy(newItem.value, false, undefined, undefined, level+1);\n          if (doReplace) {\n            break;\n          }\n        }\n        else if (oldItem.type === \"textnode\" && oldItem.value !== newItem.value) {\n          if (oldItem.el) {\n            oldItem.el.textContent = newItem.value;\n          }\n          oldItem.value = newItem.value;\n        }\n\n        oldIndex++;\n        newIndex++;\n      }\n    }\n    \n    // Need to copy stuff - first delete all the old contents\n    let oldStartIndex = oldIndex;\n    let oldItem       = this.contents[oldIndex];\n\n    while (oldItem) {\n      if (jstObject && oldItem.jstObject._jstId !== jstObject._jstId) {\n        break;\n      }\n      // console.log(\"      \" + \" \".repeat(level*2), \"deleting old item :\", oldItem);\n      this._deleteItem(oldItem);\n      oldIndex++;\n      oldItem = this.contents[oldIndex];\n    }\n\n    this.contents.splice(oldStartIndex, oldIndex - oldStartIndex);\n\n    if (newJst.contents[newIndex]) {\n      // Remove the old stuff and insert the new\n      let newItems = newJst.contents.splice(newIndex, newJst.contents.length - newIndex);\n      // console.log(\"      \" + \" \".repeat(level*2), \"new items being added:\", newItems);\n      for (let newItem of newItems) {\n        if (newItem.jstObject) {\n          newItem.jstObject.setParent(this);\n        }\n      }\n      this.contents.splice(oldStartIndex, 0, ...newItems);\n    }\n\n    // console.log(\"CAC>\" + \" \".repeat(level*2), \"/\" + this.tag+this.aId);\n    return false;\n    \n  }\n\n  _deleteItem(contentsItem) {\n    if (contentsItem.type === \"jst\") {\n      contentsItem.value.delete();\n    }\n    else if (contentsItem.type === \"textnode\") {\n      if (contentsItem.el && contentsItem.el.parentNode) {\n        // Remove the span element\n        contentsItem.el.parentNode.removeChild(contentsItem.el);\n        delete contentsItem.el;\n      }\n    }\n    else {\n      console.warn(\"Unexpected content type while deleting:\", contentsItem.type);\n    }\n  }\n\n  // This is the meat of all of JST - it is what takes a list of arguments to\n  // a jst element (e.g. jst.$div(...)) and converts it into something that represents\n  // a tree of nodes. The passed in params can be a list of lists (will be flattened),\n  // an object (converted to attributes), strings, numbers, booleans (coverted to textnodes)\n  // or other JST objects. If you understand what is going on here, then you really\n  // understand what JST is all about\n  _processParams(params, jstObject) {\n    params = jst._flatten.apply(this, params);\n    if (typeof params === \"undefined\") {\n      params = [];\n    }\n    for (let param of params) {\n      let type = typeof param;\n\n      if (type === \"number\" || type === \"string\") {\n        this.contents.push({type: \"textnode\", value: param, jstObject: jstObject});\n      }\n      else if (type === \"boolean\") {\n        this.contents.push({type: \"textnode\", value: param.toString(), jstObject: jstObject});\n      }\n      else if (param instanceof JstObject) {\n        if (!param.getParent()) {\n          param.setParent(this);\n        }\n\n        let items = param.render();\n        this._processParams([items], param);\n      }\n      else if (param instanceof JstElement) {\n        this.contents.push({type: \"jst\", value: param, jstObject: jstObject});\n      }\n      else if (typeof HTMLElement !== 'undefined' && param instanceof HTMLElement) {\n        this.contents.push({type: \"jst\", value: new JstElement(param), jstObject: jstObject});\n      }\n      else if (type === \"object\") {\n        for (let name of Object.keys(param)) {\n          if (typeof(param[name]) === \"undefined\") {\n            param[name] = \"\";\n          }\n          if (name === \"jstoptions\" && param.jstoptions instanceof Object) {\n            this.opts = param.jstoptions;\n          }\n          else if (name === \"properties\" && param.properties instanceof Array) {\n            for (let prop of param.properties) {\n              this.props.push(prop);\n            }\n          }\n          else if (name === \"events\" && typeof param.events === \"object\") {\n            for (let event of Object.keys(param.events)) {\n              if (param.events[event] instanceof Function) {\n                this.events[event] = {listener: param.events[event]};\n              }\n              else {\n                this.events[event] = param.events[event];\n              }\n            }\n          }\n          else if (name === \"ref\") {\n            this.ref       = param[name];\n            this.attrs.ref = param[name];\n          }\n          else if (name === \"cn\") {\n            // A bit of magic for the \"class\" attribute: cn -> class\n            // We also will append to the class if there already is one\n            if (this.attrs['class']) {\n              this.attrs['class'] += \" \" + param[name];\n            }\n            else {\n              this.attrs['class'] = param[name];\n            }\n          }\n          else {\n            this.attrs[name] = param[name];\n          }\n        }\n      }\n      else if (type === \"undefined\") {\n        // skip\n      }\n      else {\n        console.log(\"Unknown JstElement parameter type: \", type);\n      }\n    }\n  }\n\n\n  // Some helpers\n  _quoteAttrValue(value) {\n    return value.replace ? value.replace(/\"/, '\\\"') : value;\n  }\n\n}\n\n\njst.fn = jst.prototype = {};\n\n\n// Shrunken version of jQuery's extend\njst.extend = jst.fn.extend = function() {\n  let target = this;\n  let length = arguments.length;\n\n  for (let i = 0; i < length; i++) {\n    let options;\n    if ((options = arguments[i]) !== null) {\n      for (let name in options) {\n        let copy = options[name];\n\n        // Prevent never-ending loop\n        if (target === copy) {\n          continue;\n        }\n\n        if (copy !== undefined) {\n          target[name] = copy;\n        }\n      }\n    }\n  }\n\n  // Return the modified object\n  return target;\n};\n\n\njst.extend({\n  tagPrefix: \"$\",\n  tags: [\n    'a', 'abbr', 'address', 'area', 'article', 'aside', 'audio', 'b', 'base',\n    'bdi', 'bdo', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption',\n    'cite', 'code', 'col', 'colgroup', 'command', 'data', 'datalist', 'dd',\n    'del', 'details', 'dfn', 'div', 'dl', 'dt', 'em', 'embed', 'fieldset',\n    'figcaption', 'figure', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5',\n    'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'iframe', 'img', 'input',\n    'ins', 'kbd', 'keygen', 'label', 'legend', 'li', 'link', 'main', 'map', 'mark', 'math',\n    'menu', 'meta', 'meter', 'nav', 'noscript', 'object', 'ol', 'optgroup', 'option',\n    'output', 'p', 'param', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's',\n    'samp', 'script', 'section', 'select', 'small', 'source', 'span', 'strong',\n    'style', 'sub', 'summary', 'sup', 'svg', 'table', 'tbody', 'td', 'textarea',\n    'tfoot', 'th', 'thead', 'time', 'title', 'tr', 'track', 'u', 'ul', 'var',\n    'video', 'wbr'\n  ],\n\n  // If there are some new elements that you want to insert into the DOM that\n  // aren't in the hardcoded list above, then you can add them with this\n  // (raise a github issue too, so they can be added to the list if they are\n  // generally useful)\n  addCustomElements: function() {\n    let names = jst._flatten.apply(this, arguments);\n\n    for (let name of names) {\n      let fullName = jst.tagPrefix + name;\n      jst[fullName] = function() {\n        let args = jst._flatten.apply(this, arguments);\n        return (new JstElement(name, args));\n      };\n    }\n  },\n\n  // Called automatically\n  init: function() {\n    jst.addCustomElements(jst.tags);\n  },\n\n  // Used to associate a generic object with JST so that it can be used\n  // as a refreshable datasource for a template\n  object: function(obj) {\n    if (typeof(obj) != \"object\") {\n      throw(new Error(\"You must pass an object to jst.object()\"));\n    }\n    return obj.$jst = new JstObject(obj);\n  },\n\n  // Put all the element functions (e.g. $div(), $span()) in the global (window)\n  // namespace\n  makeGlobal: function(prefix) {\n    jst.global          = true;\n    jst.globalTagPrefix = prefix || jst.tagPrefix;\n    for (let tag of jst.tags) {\n      let name = jst.globalTagPrefix + tag;\n      let g = typeof global !== 'undefined' ? global : window;\n      g[name] = function() {\n        return jst[name].apply(this, arguments);\n      };\n    }\n  },\n\n  _flatten: function() {\n    var flat = [];\n    for (var i = 0; i < arguments.length; i++) {\n      if (arguments[i] instanceof Array) {\n        flat.push.apply(flat, jst._flatten.apply(this, arguments[i]));\n      }\n      else if (arguments[i] instanceof Function) {\n        let result = arguments[i]();\n        if (result instanceof Array) {\n          flat.push.apply(flat, jst._flatten.apply(this, result));\n        }\n        else {\n          flat.push(result);\n        }\n      }\n      else {\n        flat.push(arguments[i]);\n      }\n    }\n    return flat;\n  }\n\n});\n\njst.init();\n\n"]}