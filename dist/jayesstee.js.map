{"version":3,"sources":["../src/jayesstee.js"],"names":["jst","selectorOrElement","HTMLElement","JstElement","el","document","querySelector","globalJstObjectId","globalJstObjectClassId","globalJstElementId","JstObject","companionObj","_jstId","_companionObj","_renderFunc","undefined","_forms","_wasRendered","_jstEl","_refCount","updateWithParent","constructor","prototype","_jstClassIds","name","_jstClassId","_classPrefix","_fullPrefix","_type","getName","getFullPrefix","styleManager","removeCss","opts","isParentUpdate","css","renderCss","updateCss","items","_render","newJst","type","getType","_processParams","_compareAndCopy","_unrender","isDomified","dom","resolve","then","_postRender","html","refresh","render","Error","postRender","unrender","delete","destroy","someCss","rawCss","_normalizeCss","renderFunc","jstElement","attrs","id","setJstElement","JstFormManager","form","getValues","refName","val","JstStyle","classPrefix","className","cssGlobal","cssLocal","cssInstance","fullPrefix","processedCss","_processCss","map","instance","$style","item","typeInfo","prefix","block","push","_stringify","text","selector","atRuleRule","match","rules","scopedSelector","replace","_stringifyObj","obj","indent","Object","toString","prop","attr","m","toLowerCase","reduce","acc","rgbaString","substr","JstStyleManager","jstStyleLookup","jstStyles","jstObj","getClassPrefix","jstStyle","madeNew","_addStyle","_removeStyle","index","entry","splice","inputs","Array","isArray","vals","input","checked","value","tag","params","contents","props","events","tagName","arguments","innerHTML","atts","appendChild","apply","lastJstObject","depth","repeat","attrName","p1","p2","_quoteAttrValue","length","join","console","warn","lastJstForm","createElement","ref","setRef","addForm","addInput","jstObject","setAttribute","propName","event","addEventListener","listener","nextEl","contentsStack","sanity","debug","hasEl","childEl","insertBefore","createTextNode","stackItem","pop","_deleteItem","parentNode","removeChild","topNode","forceUpdate","level","oldIndex","newIndex","removeAttribute","fixProps","i","eventName","removeEventListener","oldItem","newItem","doReplace","textContent","oldStartIndex","itemsToDelete","newItems","itemToDelete","contentsItem","isUpdate","_flatten","param","jstoptions","properties","Function","fn","extend","target","options","copy","tagPrefix","Form","Element","tags","cssFuncs","cssUnits","addCustomElements","names","fullName","args","addCssFunctions","camelName","toUpperCase","addCssUnits","fixed","arg","object","$jst","makeGlobal","global","globalTagPrefix","g","window","if","ifTrue","ifFalse","setDebug","_init","_addCssUnit","unit","flat","result","evenFlatter","concat","_normalizeCssObject","atRules","sel","fixedSetting","has","processed","parts","split","shift","part","setting","_normalizeCssStyles","tmpObj","rgb","string","fixedObj"],"mappings":"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","file":"jayesstee.js","sourcesContent":["// Jayesstee (JST) is a pure javascript HTML templating\n// library, that lets you build HTML (and insert into the DOM)\n// using functional javascript \n//\n// Copyright 2018 Edward Funnekotter All rights reserved\n\nexport function jst(selectorOrElement) {\n  if (selectorOrElement instanceof HTMLElement) {\n    return new JstElement(selectorOrElement);\n  }\n  else {\n    let el = document.querySelector(selectorOrElement);\n    if (!el) {\n      return new JstElement();\n    }\n    else {\n      return new JstElement(el);\n    }\n  }\n}\n \nexport default jst;\n\n// Some global unique identifiers\nlet globalJstObjectId       = 1;\nlet globalJstObjectClassId  = 1;\nlet globalJstElementId      = 1;\n\n// JstObject Class\n//\n// This class is a base class for all classes that are\n// renderable within jayesstee. For a user-defined class to\n// be successfully redered, it must extend this class and\n// implement the render() method\n//\n// It can also be used as a companion object for generic\n// objects. Calling jst.object(someObj) will return one of these\n// objects that is linked to someObj (someObj.$jst is this object and\n// this.companionObj is the passed in object).\nexport class JstObject {\n  constructor(companionObj) {\n    this._jstId           = globalJstObjectId++;\n    this._companionObj    = companionObj;\n    this._renderFunc      = undefined;\n    this._forms           = {};\n    this._wasRendered     = false;\n    this._jstEl           = undefined;\n    this._refCount        = 0;\n    this.updateWithParent = false;\n\n    // TODO - there must be a better way to do this\n    // Note that orginally, it just stored the _jstClassId directly\n    // on this.constructor.prototype, but that resulted in parent classes ending up\n    // with the same ID as the child (e.g. InputButton -> Input -> JstObject,\n    // InputButton and Input got the same ID)\n    if (!this.constructor.prototype._jstClassIds) {\n      this.constructor.prototype._jstClassIds = {};\n    }\n    if (!this.constructor.prototype._jstClassIds[this.constructor.name]) {\n      this.constructor.prototype._jstClassIds[this.constructor.name] = globalJstObjectClassId++;\n    }\n\n    this._jstClassId = this.constructor.prototype._jstClassIds[this.constructor.name];\n\n    this._classPrefix     = `jsto${this._jstClassId}-`;\n    this._fullPrefix      = `jsto${this._jstClassId}-i${this._jstId}-`;\n    this._type            = `${this.getName()}-${this.getFullPrefix()}`;\n\n  }\n\n  destroy() {\n    jst.styleManager.removeCss(this);\n  }\n\n  // Refresh the instantiation of this object\n  // Should be called after dependent data is changed\n  refresh(opts) {\n\n    let isParentUpdate = opts ? opts.isParentUpdate : false;\n    \n    if (!isParentUpdate && !this._jstEl) {\n      return;\n    }\n    \n    // Gather all the styles for this object\n    let css     = this.renderCss(opts);\n    if (css) {\n      jst.styleManager.updateCss(this, css);\n    }\n\n    this._refCount++;\n    // console.warn(\"refresh:\", this._type, this._refCount);\n    if (!this._jstEl && isParentUpdate ||\n        (isParentUpdate && this.updateWithParent) ||\n        !isParentUpdate\n       ) {\n    \n      // Create a new JST tree that will be compared against the existing one\n      let items   = this._render();\n\n      // newJst will contain the new updated tree\n      let newJst = new JstElement(\"jstobject\", [{type: this.getType()}]);\n      newJst._processParams([items], true);\n\n      if (this._jstEl){\n        // Compare with the existing tree to find what needs to change\n        this._jstEl._compareAndCopy(newJst, true, this, false, 0);\n        // Need to call unrender to decrement the refcount for the temp\n        // object\n        this._unrender();\n      }\n      else {\n        this._jstEl = newJst;\n      }\n      \n      // If we were already domified, then redo it for the new elements\n      if (this._jstEl.isDomified) {\n        this._jstEl.dom(this);\n      }\n\n      Promise.resolve().then(() => this._postRender());\n      \n    }\n    \n  }\n\n  html() {\n    if (this._jstEl) {\n      return this._jstEl.html();\n    }\n    else {\n      this.refresh({isParentUpdate: true});\n      return this._jstEl.html();\n    }\n  }\n\n  // Internally called render function - will call publically\n  // available one \n  _render() {\n    let items = this.render();\n    this._wasRendered = true;\n    return items;\n  }\n\n  // Called automatically on instantiation or refresh\n  // This must be overrided in classes inheriting from JstObject\n  render() {\n    if (!this._renderFunc) {\n      if (this._companionObj) {\n        throw(new Error(\"You must define a render function with .fill()\"));\n      }\n      else {\n        throw(new Error(\"You must override render() in descendant classes\"));\n      }\n    }\n    else {\n      return this._renderFunc(this._companionObj);\n    }\n  }\n\n  // Internally called postRender function\n  _postRender() {\n    this.postRender();\n  }\n\n  // Empty base class for postRender - sub classes can override\n  postRender() {\n  }\n\n  // Called when a parent no longer wants this object's tree in the DOM\n  _unrender() {\n    this._refCount--;\n    // console.warn(\"unrender:\", this._type, this._refCount);\n    if (this._refCount < 0) {\n      throw new Error(\"Invalid ref count in jstobject\", this);\n    }\n    if (this._refCount == 0) {\n      this.unrender();\n      if (this._jstEl) {\n        this._jstEl.delete();\n        delete(this._jstEl);\n      }\n      this.destroy();\n    }\n  }\n\n  // Can be overrided in the sub class \n  unrender() {\n  }\n\n  // Called automatically on instantiation or full refresh\n  renderCss() {\n    let css = {};\n    let someCss = false;\n    for (let type of ['cssGlobal', 'cssLocal', 'cssInstance']) {\n      if (this[type]) {\n        let rawCss = this[type]();\n        if (rawCss) {\n          css[type] = jst._normalizeCss(rawCss);\n          someCss = true;\n        }\n      }\n    }\n    return someCss ? css : undefined;\n  }\n\n  getWasRendered() {\n    return this._wasRendered;\n  }\n\n  getClassPrefix() {\n    return this._classPrefix;\n  }\n\n  getFullPrefix() {\n    return this._fullPrefix;\n  }\n\n  getUpdateWithParent() {\n    return this.updateWithParent;\n  }\n\n  // Used to specify the render behaviour for a generic object that\n  // has been linked through jst.object(<object>)\n  fill(renderFunc) {\n    if (typeof(renderFunc) !== \"function\") {\n      throw(new Error(\".fill() expects a function to be passed in\"));\n    }\n\n    this._renderFunc = renderFunc;\n    \n    return this;\n  }\n\n  getName() {\n    return this.constructor.name;\n  }\n\n  getType() {\n    return this._type;\n  }\n\n  addForm(jstElement) {\n    let name = jstElement.attrs.name || jstElement.attrs.id || \"_unnamed_\";\n\n    if (this._forms[name]) {\n      this._forms[name].setJstElement(jstElement);\n    }\n    else {\n      this._forms[name] = new JstFormManager(jstElement);\n    }\n    return this._forms[name];\n  }\n\n  getFormValues(name) {\n    let form = this._forms[name || \"_unnamed_\"];\n    return form ? form.getValues() : {};\n  }\n\n  // Internal function to record the reference name\n  setRef(refName, val) {\n    if (this._companionObj) {\n      this._companionObj[refName] = val;\n    }\n    else {\n      this[refName] = val;\n    }\n  }\n\n  // Get file, line and column info\n  _getCodeLocation() {\n    \n  }\n}\n\n\n// JstStyle Class\n//\n// This renders a single style block\nclass JstStyle extends JstObject {\n  constructor(classPrefix, className) {\n    super();\n    this.classPrefix = classPrefix;\n    this.className   = className;\n    this.css         = {\n      cssGlobal:   [],\n      cssLocal:    [],\n      cssInstance: {}\n    };\n  }\n\n  updateCss(fullPrefix, css) {\n    let processedCss = this._processCss(fullPrefix, css);\n    this.css.cssGlobal = processedCss.cssGlobal;\n    this.css.cssLocal  = processedCss.cssLocal;\n\n    if (!this.css.cssInstance) {\n      this.css.cssInstance = {};\n    }\n    this.css.cssInstance[fullPrefix] = processedCss.cssInstance;\n    this.refresh();\n  }\n\n  removeCss(fullPrefix) {\n    if (this.css.cssInstance[fullPrefix]) {\n      delete(this.css.cssInstance[fullPrefix]);\n      this.refresh();\n    }\n  }\n\n  render() {\n    return [\"cssGlobal\", \"cssLocal\", \"cssInstance\"].map(\n      type => {\n        if (this.css && this.css[type]) {\n          if (type === \"cssInstance\") {\n            return Object.values(this.css.cssInstance).map(\n              instance => instance.map(item => jst.$style(item)));\n          }\n          else {\n            return this.css[type].map(item => {\n              return jst.$style(item);\n            });\n          }\n        }\n        return undefined;\n      }\n    );\n  }\n\n  // Override the type to put more useful info\n  getType() {\n    return `${this.getName()}-${this.className}`;\n  }\n\n  // Go through the new CSS and either update existing CSS or\n  // replace what is there, if changed \n  _processCss(fullPrefix, css) {\n    let processedCss = {};\n    for (let typeInfo of [\n      [\"cssGlobal\"               ],\n      [\"cssLocal\",    this.classPrefix],\n      [\"cssInstance\", fullPrefix ]\n    ]) {\n      let type   = typeInfo[0];\n      let prefix = typeInfo[1];\n\n      processedCss[type] = [];\n      \n      if (css[type]) {\n        for (let block of css[type]) {\n          if (block) {\n            processedCss[type].push(this._stringify(prefix, block));\n          }\n        }\n      }\n    }\n    return processedCss;\n  }\n\n  // Stringify the CSS into blocks suitable for insertion into the DOM\n  _stringify(prefix, block) {\n    let text = \"\";\n    for(let selector of Object.keys(block)) {\n      let atRuleRule;\n      if (selector.match(/^@/)) {\n        atRuleRule = block[selector][\":rule\"];\n        delete(block[selector][\":rule\"]);\n      }\n      \n      let rules = block[selector];\n      if (typeof(atRuleRule) != \"undefined\") {\n        text += `${selector} ${atRuleRule} {\\n`;\n        text += this._stringify(prefix, rules);\n        text += `}\\n`;\n      }\n      else {\n        let scopedSelector = prefix ? selector.replace(/([\\.#])/g, `$1${prefix}`) : selector;\n        text += `${scopedSelector} `;\n        text += this._stringifyObj(rules, \"\");\n      }\n    }\n    return text;\n  }\n\n  _stringifyObj(obj, indent) {\n    if (!(obj instanceof Object)) {\n      if (typeof obj !== \"undefined\" && obj.toString) {\n        return obj.toString();\n      }\n      else {\n        return \"\";\n      }\n    }\n    let text = \"{\\n\";\n    for (let prop of Object.keys(obj)) {\n      let val = obj[prop];\n      let attr = prop.replace(/([A-Z])/g, m => \"-\"+m.toLowerCase());\n      val = val.reduce ? val.reduce((acc, item) =>\n                                    acc + \" \" + this._stringifyObj(item, indent + \"  \"), \"\") :\n        val.rgbaString ? val.rgbaString : val.toString();\n      val = val.replace(/\\s+/, \" \");\n      if (val.substr(-2,1) !== \"}\") {\n      text += `${indent}  ${attr}: ${val};\\n`;\n      }\n      else {\n        text += `${indent}  ${attr} ${val}`;\n      }\n    }\n    text += `${indent}}\\n`;\n    return text;\n  }\n  \n}\n\n\n// JstStyleManager Class\n//\n// This class defines the singletone that manages the set of style elements\n// that are inserted for application created CSS\nclass JstStyleManager extends JstObject {\n  constructor() {\n    super();\n    this.jstStyleLookup = {};\n    this.jstStyles      = [];\n  }\n\n  render() {\n    return this.jstStyles;\n  }\n  \n  updateCss(jstObj, css) {\n    let classPrefix = jstObj.getClassPrefix();\n    let fullPrefix  = jstObj.getFullPrefix();\n\n    let jstStyle    = this.jstStyleLookup[classPrefix];\n\n    let madeNew = false;\n    if (!jstStyle) {\n      jstStyle = new JstStyle(classPrefix, jstObj.getName());\n      madeNew = true;\n    }\n\n    jstStyle.updateCss(fullPrefix, css);\n\n    if (madeNew) {\n      this._addStyle(jstStyle, classPrefix);\n    }\n    else {\n      jstStyle.refresh();\n    }\n    \n  }\n\n  removeCss(jstObj) {\n    let classPrefix = jstObj.getClassPrefix();\n    let fullPrefix  = jstObj.getFullPrefix();\n\n    let jstStyle    = this.jstStyleLookup[classPrefix];\n\n    if (jstStyle) {\n      jstStyle.removeCss(fullPrefix);\n      this._removeStyle(jstStyle, classPrefix);\n    }\n  }\n\n  _addStyle(jstStyle, classPrefix) {\n    this.jstStyles.push(jstStyle);\n    this.jstStyleLookup[classPrefix] = jstStyle;\n    this.refresh();\n  }\n\n  _removeStyle(jstStyle, classPrefix) {\n    // TODO - need some sort of ref counting of\n    // users of local styles so they can be removed\n    // when last user is gone\n    return;\n    let index = 0;\n    for (let entry of this.jstStyles) {\n      if (jstStyle === entry) {\n        this.jstStyles.splice(index, 1);\n        delete(this.jstStyleLookup[classPrefix]);\n        break;\n      }\n      index++;\n    }\n    this.refresh();\n  }\n\n}\n\n\n\n// JstFormManager Class\n//\n// Holds some information about forms\nclass JstFormManager {\n  constructor(jstElement) {\n    this.jstElement = jstElement;\n    this.inputs     = {};\n  }\n\n  addInput(jstElement) {\n    let name = jstElement.attrs.name || jstElement.attrs.id;\n    if (name) {\n      if (this.inputs[name]) {\n        if (Array.isArray(this.inputs[name])) {\n          this.inputs[name].push(jstElement);\n        }\n        else {\n          this.inputs[name] = [this.inputs[name], jstElement];\n        }\n      }\n      else {\n        this.inputs[name] = jstElement;\n      }\n    }\n  }\n\n  setJstElement(jstElement) {\n    this.jstElement = jstElement;\n  }\n\n  getValues() {\n    let vals = {};\n    for (let name of Object.keys(this.inputs)) {\n      if (Array.isArray(this.inputs[name])) {\n        if (this.inputs[name][0].attrs.type && this.inputs[name][0].attrs.type.toLowerCase() === \"radio\") {\n          for (let input of this.inputs[name]) {\n            if (input.el.checked) {\n              vals[name] = input.attrs.value || input.attrs.id;\n            }\n          }\n        }\n        else if (this.inputs[name][0].attrs.type && this.inputs[name][0].attrs.type.toLowerCase() === \"checkbox\") {\n          vals[name] = [];\n          for (let input of this.inputs[name]) {\n            if (input.el.checked) {\n              vals[name].push(input.attrs.value || input.attrs.id);\n            }\n          }\n        }\n        else {\n          vals[name] = this.inputs[name][0].el.value;\n        }\n      }\n      else {\n        vals[name] = this.inputs[name].el.value;\n      }\n    }\n    return vals;\n  }\n  \n}\n\n\n// JstElement Class\n//\n// This class represents an HTML element. On creation\n// it is just a scaffold that can be either inserted into\n// the DOM (in a browser) or serialized into HTML.\nclass JstElement {\n  constructor(tag, params) {\n    this.id       = globalJstElementId++;\n    this.contents = [];\n    this.attrs    = {};\n    this.props    = [];\n    this.events   = {};\n    this.opts     = {};\n\n    if (tag instanceof HTMLElement) {\n      // Wrapping an element with a JstElement\n      this.tag = tag.tagName.toLowerCase();\n      this.el  = tag;\n    }\n    else {\n      this.tag = tag.toLowerCase();\n    }\n\n    this._processParams(params);\n\n    if (this.el) {\n      // If we have a real element, put all the content into it\n      this.dom();\n    }\n  }\n\n  appendChild() {\n    this.isDomified = false;\n\n    this._processParams(arguments);\n    if (this.el) {\n      this.dom();\n    }\n  }\n\n  replaceChild() {\n    if (this.el) {\n      this.el.innerHTML = \"\";\n    }\n\n    this.isDomified = false;\n    this.contents   = [];\n    this.atts       = [];\n    this.props      = [];\n\n    this.appendChild.apply(this, arguments);\n  }\n\n  // Return HTML\n  html(opts, lastJstObject) {\n    let html = \"\";\n\n    if (!opts)       { opts = {}; }\n    if (!opts.depth) { opts.depth = 0; }\n    if (opts.indent) { html += \" \".repeat(opts.indent * opts.depth++); }\n\n    html += \"<\" + this.tag;\n\n    let attrs = [];\n    for (let attrName of Object.keys(this.attrs)) {\n      let val = this.attrs[attrName];\n      if (lastJstObject && (attrName === \"class\" || attrName === \"id\") && val.match && val.match(/(^|\\s)-/)) {\n        val = val.replace(/(^|\\s)(--?)/g, (m, p1, p2) => p1 + (p2 === \"-\" ? lastJstObject.getClassPrefix() : lastJstObject.getFullPrefix()));\n      }\n      attrs.push(attrName + \"=\" + \"\\\"\" + this._quoteAttrValue(val) + \"\\\"\");\n    }\n    if (attrs.length) {\n      html += \" \" + attrs.join(\" \");\n    }\n    if (this.props.length) {\n      html += \" \" + this.props.join(\" \");\n    }\n\n    html += \">\";\n\n    if (opts.indent) {\n      html += \"\\n\";\n    }\n\n    for (let item of this.contents) {\n      if (item.type === \"jst\") {\n        html += item.value.html(opts, lastJstObject);\n      }\n      else if (item.type === \"obj\" && item.value._jstEl) {\n        html += item.value._jstEl.html(opts, item.value);\n      }\n      else if (item.type === \"HTMLElement\") {\n        html += item.value.innerHTML;\n      }\n      else if (item.type === \"textnode\") {\n        if (opts.indent && opts.depth) {\n          html += \" \".repeat(opts.indent * opts.depth);\n        }\n        html += item.value;\n        if (opts.indent && opts.depth) {\n          html += \"\\n\";\n        }\n      }\n      else {\n        console.warn(\"Unexpected content type while serializing:\", item.type);\n      }\n    }\n\n    if (opts.indent && opts.depth) {\n      opts.depth--;\n      html += \" \".repeat(opts.indent * opts.depth);\n    }\n\n    html += `</${this.tag}>`;\n    if (opts.indent) {\n      html += \"\\n\";\n    }\n    return html;\n  }\n\n  // Instantiate into the DOM and return the HTMLElement\n  dom(lastJstObject, lastJstForm) {\n    // console.warn(\"Domming:\", this.tag, this.attrs.class, lastJstObject);\n    let el = this.el || document.createElement(this.tag);\n\n    if (this.ref && lastJstObject) {\n      lastJstObject.setRef(this.ref, this);\n    }\n\n    // Handle forms\n    if (lastJstObject && this.tag === \"form\" && (this.attrs.name || this.attrs.id)) {\n      lastJstForm = lastJstObject.addForm(this);\n    }\n    else if (lastJstForm &&\n             (this.tag === \"input\" ||\n              this.tag === \"textarea\" ||\n              this.tag === \"select\")) {\n      lastJstForm.addInput(this);\n    }\n\n    if (!this.isDomified) {\n      \n      this.jstObject = lastJstObject;\n      \n      for (let attrName of Object.keys(this.attrs)) {\n        let val = this.attrs[attrName];\n        if (lastJstObject && (attrName === \"class\" || attrName === \"id\") && val.match && val.match(/(^|\\s)-/)) {\n          val = val.replace(/(^|\\s)(--?)/g, (m, p1, p2) => p1 + (p2 === \"-\" ? lastJstObject.getClassPrefix() : lastJstObject.getFullPrefix()));\n        }\n        el.setAttribute(attrName, val);\n      }\n      for (let propName of this.props) {\n        el[propName] = true;\n      }\n      for (let event of Object.keys(this.events)) {\n        // TODO: Add support for options - note that this will require\n        //       some detection of options support in the browser...\n        el.addEventListener(event, this.events[event].listener);\n      }\n    }\n\n    let nextEl;\n    let contentsStack = [];\n    let index         = this.contents.length - 1;\n    let contents      = this.contents;\n    let sanity        = 100000000;\n    if (index >= 0) {\n      while (sanity--) {\n        let item = contents[index];\n        let jstObj = lastJstObject;\n        if (item.type === \"jst\" || item.type === \"obj\") {\n          if (0 && !jst.debug && item.type && item.value._jstEl &&\n              item.value._jstEl.contents.length) {\n            // TODO - note that stuff changed with lastJstObject (introduced jstObj)\n            // Work on jstobject's items instead\n            if (index) {\n              contentsStack.push([index - 1, contents, lastJstObject]);\n            }\n            contents      = item.value._jstEl.contents;\n            index         = contents.length - 1;\n            lastJstObject = item.value;            \n            continue;\n          }\n          else if (item.type === \"obj\") {\n            jstObj = item.value;\n            if (item.value._jstEl) {\n              item = {value: item.value._jstEl, type: \"jst\"};\n            }\n          } \n          let hasEl   = item.value.el; \n          let childEl = item.value.dom(jstObj, lastJstForm);\n          if (!hasEl) {\n            if (nextEl) {\n              el.insertBefore(childEl, nextEl);\n            }\n            else {\n              el.appendChild(childEl);\n            }\n          }\n          nextEl = childEl;\n        }\n        else if (item.type === \"textnode\") {\n          if (!item.el) {\n            item.el = document.createTextNode(item.value);\n            if (nextEl) {\n              el.insertBefore(item.el, nextEl);\n            }\n            else {\n              el.appendChild(item.el);\n            }\n          }\n          nextEl = item.el;\n        }\n        else {\n          console.warn(\"Unexpected content type while dominating:\", item.type);\n        }\n\n        if (!index) {\n          if (contentsStack.length) {\n            let stackItem = contentsStack.pop();\n            index         = stackItem[0];\n            contents      = stackItem[1];\n            lastJstObject = stackItem[2];\n          }\n          else {\n            break;\n          }\n        }\n        else {\n          index--;\n        }\n      }        \n    }\n\n    this.el         = el;\n    this.isDomified = true;\n    return el;\n  }\n\n  // Delete this element and remove from the DOM if there\n  delete() {\n    // Remove all items associated with this JstElement\n    for (let item of this.contents) {\n      this._deleteItem(item);\n    }\n\n    // Remove any reference to the JstObject (circular reference)\n    delete this.jstObject;\n\n    // Delete this element, if present\n    if (this.el) {\n      if (this.el.parentNode) {\n        this.el.parentNode.removeChild(this.el);\n      }\n    }\n\n    delete this.el;\n\n    this.tag      = \"-deleted-\";\n    this.contents = [];\n    this.attrs    = {};\n    this.props    = [];\n  }\n\n  // Takes a new Jst tree and will do a full comparison to find the differences\n  // which will then be copied into the real tree in preparation for changing\n  // the DOM \n  // Returns true if upper layer needs to copy new Jst. False otherwise\n  _compareAndCopy(newJst, topNode, jstObject, forceUpdate, level) {\n    let oldIndex = 0;\n    let newIndex = 0;\n\n    // console.log(\"CAC>\" + \" \".repeat(level*2), this.tag + this.id, newJst.tag+newJst.id);\n    \n    // First check the attributes, props and events\n    // But only if we aren't the topNode\n    if (!topNode) {\n      if (forceUpdate || this.opts.forceUpdate || this.tag !== newJst.tag) {\n        return true;\n      }\n\n      // Blindly copy the JST options\n      this.opts = newJst.opts;\n      \n      // Just fix all the attributes inline\n      for (let attrName of Object.keys(this.attrs)) {\n        if (!newJst.attrs[attrName]) {\n          delete this.attrs[attrName];\n          if (this.isDomified) {\n            this.el.removeAttribute(attrName);\n          }\n        }\n        else if (newJst.attrs[attrName] !== this.attrs[attrName]) {\n          this.attrs[attrName] = newJst.attrs[attrName];\n          if (this.isDomified) {\n            //refactor\n            let val = newJst.attrs[attrName];\n            if (this.jstObject && (attrName === \"class\" || attrName === \"id\") && val.match(/(^|\\s)-/)) {\n              val = val.replace(/(^|\\s)(--?)/g, (m, p1, p2) => p1 + (p2 === \"-\" ?\n                                                                     this.jstObject.getClassPrefix() :\n                                                                     this.jstObject.getFullPrefix()));\n            }\n            this.el.setAttribute(attrName, val);\n          }\n        }\n      }\n      for (let attrName of Object.keys(newJst.attrs)) {\n        if (!this.attrs[attrName]) {\n          this.attrs[attrName] = newJst.attrs[attrName];\n          if (this.isDomified) {\n            //refactor\n            let val = newJst.attrs[attrName];\n            if (this.jstObject && (attrName === \"class\" || attrName === \"id\") && val.match(/(^|\\s)-/)) {\n              val = val.replace(/(^|\\s)(--?)/g, (m, p1, p2) => p1 + (p2 === \"-\" ?\n                                                                     this.jstObject.getClassPrefix() :\n                                                                     this.jstObject.getFullPrefix()));\n            }\n            this.el.setAttribute(attrName, val);\n          }\n        }\n      }\n\n      if (this.props.length || newJst.props.length) {\n        let fixProps = false;\n        \n        // Just compare them in order - if they happen to be the same,\n        // but in a different order, we will do a bit more work than necessary\n        // but it should be very unlikely that that would happen\n        if (this.props.length != newJst.props.length) {\n          fixProps = true;\n        }\n        else {\n          for (let i = 0; i < this.props.length; i++) {\n            if (this.props[i] !== newJst.props[i]) {\n              fixProps = true;\n              break;\n            }\n          }\n        }\n        \n        if (fixProps) {\n          if (this.isDomified) {\n            for (let prop of this.props) {\n              delete this.el[prop];\n            }\n            for (let prop of newJst.props) {\n              this.el[prop] = true;\n            }\n          }\n          this.props = newJst.props;\n        }\n      }\n      \n      // Fix all the events\n      for (let eventName of Object.keys(this.events)) {\n        if (!newJst.events[eventName]) {\n          if (this.isDomified) {\n            this.el.removeEventListener(eventName, this.events[eventName].listener);\n          }\n          delete this.events[eventName];\n        }\n        else if (newJst.events[eventName].listener !== this.events[eventName].listener) {\n          if (this.isDomified) {\n            this.el.removeEventListener(eventName, this.events[eventName].listener);\n            this.el.addEventListener(eventName, newJst.events[eventName].listener);\n          }\n          this.events[eventName] = newJst.events[eventName];\n        }\n      }\n      for (let eventName of Object.keys(newJst.events)) {\n        if (!this.events[eventName]) {\n          this.events[eventName] = newJst.events[eventName];\n          if (this.isDomified) {\n            this.el.addEventListener(eventName, newJst.events[eventName].listener);\n          }\n        }\n      }\n    }\n\n    if (!forceUpdate && !this.opts.forceUpdate) {\n      while (true) {\n        let oldItem = this.contents[oldIndex];\n        let newItem = newJst.contents[newIndex];\n\n        if (!oldItem || !newItem) {\n          break;\n        }\n\n        if (oldItem.type !== newItem.type) {\n          break;\n        }\n\n        if (oldItem.type === \"jst\") {\n          // If the tags are the same, then we must descend and compare\n          let doReplace = oldItem.value._compareAndCopy(newItem.value, false, undefined, undefined, level+1);\n          if (doReplace) {\n            break;\n          }\n        }\n        else if (oldItem.type === \"obj\") {\n          // If the tags are the same, then we must descend and compare\n          if (oldItem.value._jstId != newItem.value._jstId) {\n            // Different JstObjects\n            break;\n          }\n          // Don't bother descending into JstObjects - they take care of themselves\n        }\n        else if (oldItem.type === \"textnode\" && oldItem.value !== newItem.value) {\n          if (oldItem.el) {\n            oldItem.el.textContent = newItem.value;\n          }\n          oldItem.value = newItem.value;\n        }\n\n        oldIndex++;\n        newIndex++;\n        \n        if (newItem.type === \"obj\") {\n          // Unhook this reference\n          newItem.value._unrender();\n        }\n      }\n    }\n    \n    // Need to copy stuff - first delete all the old contents\n    let oldStartIndex = oldIndex;\n    let oldItem       = this.contents[oldIndex];\n    let itemsToDelete = [];\n\n    while (oldItem) {\n      // console.log(\"CAC>  \" + \" \".repeat(level*2), \"deleting old item :\", oldItem);\n      itemsToDelete.push(oldItem);\n      oldIndex++;\n      oldItem = this.contents[oldIndex];\n    }\n\n    this.contents.splice(oldStartIndex, oldIndex - oldStartIndex);\n\n    if (newJst.contents[newIndex]) {\n      // Remove the old stuff and insert the new\n      let newItems = newJst.contents.splice(newIndex, newJst.contents.length - newIndex);\n      // console.log(\"CAC>  \" + \" \".repeat(level*2), \"new items being added:\", newItems);\n      this.contents.splice(oldStartIndex, 0, ...newItems);\n    }\n\n    for (let itemToDelete of itemsToDelete) {\n      this._deleteItem(itemToDelete);\n    }\n\n    // console.log(\"CAC>\" + \" \".repeat(level*2), \"/\" + this.tag+this.id);\n    return false;\n    \n  }\n\n  _deleteItem(contentsItem) {\n    if (contentsItem.type === \"jst\") {\n      contentsItem.value.delete();\n    }\n    else if (contentsItem.type === \"obj\") {\n      contentsItem.value._unrender();\n    }\n    else if (contentsItem.type === \"textnode\") {\n      if (contentsItem.el && contentsItem.el.parentNode) {\n        // Remove the span element\n        contentsItem.el.parentNode.removeChild(contentsItem.el);\n        delete contentsItem.el;\n      }\n    }\n    else {\n      console.warn(\"Unexpected content type while deleting:\", contentsItem.type);\n    }\n  }\n\n  // This is the meat of all of JST - it is what takes a list of arguments to\n  // a jst element (e.g. jst.$div(...)) and converts it into something that represents\n  // a tree of nodes. The passed in params can be a list of lists (will be flattened),\n  // an object (converted to attributes), strings, numbers, booleans (coverted to textnodes)\n  // or other JST objects. If you understand what is going on here, then you really\n  // understand what JST is all about\n  _processParams(params, isUpdate) {\n    params = jst._flatten.apply(this, params);\n    if (typeof params === \"undefined\") {\n      params = [];\n    }\n\n    for (let param of params) {\n      let type = typeof param;\n\n      if (param === null) {\n        // Do nothing\n      }\n      else if (type === \"number\" || type === \"string\") {\n        this.contents.push({type: \"textnode\", value: param});\n      }\n      else if (type === \"boolean\") {\n        this.contents.push({type: \"textnode\", value: param.toString()});\n      }\n      else if (param instanceof JstObject) {\n\n        // Put the JstObject into this element's contents\n        this.contents.push({type: \"obj\", value: param});\n\n        // Let the JstObject render itself\n        param.refresh({isParentUpdate: true});\n        \n      }\n      else if (param instanceof JstElement) {\n        this.contents.push({type: \"jst\", value: param});\n      }\n      else if (typeof HTMLElement !== 'undefined' && param instanceof HTMLElement) {\n        this.contents.push({type: \"jst\", value: new JstElement(param)});\n      }\n      else if (type === \"object\") {\n        for (let name of Object.keys(param)) {\n          if (typeof(param[name]) === \"undefined\") {\n            param[name] = \"\";\n          }\n          if (name === \"jstoptions\" && param.jstoptions instanceof Object) {\n            this.opts = param.jstoptions;\n          }\n          else if (name === \"properties\" && param.properties instanceof Array) {\n            for (let prop of param.properties) {\n              this.props.push(prop);\n            }\n          }\n          else if (name === \"events\" && typeof param.events === \"object\") {\n            for (let event of Object.keys(param.events)) {\n              if (param.events[event] instanceof Function) {\n                this.events[event] = {listener: param.events[event]};\n              }\n              else {\n                this.events[event] = param.events[event];\n              }\n            }\n          }\n          else if (name === \"ref\") {\n            this.ref       = param[name];\n            this.attrs.ref = param[name];\n          }\n          else if (name === \"cn\") {\n            // A bit of magic for the \"class\" attribute: cn -> class\n            // We also will append to the class if there already is one\n            if (this.attrs['class']) {\n              this.attrs['class'] += \" \" + param[name];\n            }\n            else {\n              this.attrs['class'] = param[name];\n            }\n          }\n          else if (param[name] !== \"\"){\n            this.attrs[name] = param[name];\n          }\n        }\n      }\n      else if (type === \"undefined\") {\n        // skip\n      }\n      else if (param.toString) {\n        this.contents.push({type: \"textnode\", value: param.toString()});\n      }\n      else {\n        console.warn(\"Unknown JstElement parameter type: \", type);\n      }\n    }\n  }\n\n\n  // This will manage any CSS that should be injected on behalf of\n  // the JstObject passed in\n  _processCss(jstObj, css) {\n    if (css) {\n      jst.styleManager.updateCss(jstObj, css);\n    }\n  }\n\n\n  // Some helpers\n  _quoteAttrValue(value) {\n    return value.replace ? value.replace(/\"/, '\\\"') : value;\n  }\n\n}\n\n\njst.fn = jst.prototype = {};\n\n\n// Shrunken version of jQuery's extend\njst.extend = jst.fn.extend = function() {\n  let target = this;\n  let length = arguments.length;\n\n  for (let i = 0; i < length; i++) {\n    let options;\n    if ((options = arguments[i]) !== null) {\n      for (let name in options) {\n        let copy = options[name];\n\n        // Prevent never-ending loop\n        if (target === copy) {\n          continue;\n        }\n\n        if (copy !== undefined) {\n          target[name] = copy;\n        }\n      }\n    }\n  }\n\n  // Return the modified object\n  return target;\n};\n\n\njst.extend({\n  debug:     true,\n  tagPrefix: \"$\",\n  Object:    JstObject,\n  Form:      JstFormManager,\n  Element:   JstElement,\n  tags: [\n    'a', 'abbr', 'address', 'area', 'article', 'aside', 'audio', 'b', 'base',\n    'bdi', 'bdo', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption',\n    'cite', 'code', 'col', 'colgroup', 'command', 'data', 'datalist', 'dd',\n    'del', 'details', 'dfn', 'div', 'dl', 'dt', 'em', 'embed', 'fieldset',\n    'figcaption', 'figure', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5',\n    'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'iframe', 'img', 'input',\n    'ins', 'kbd', 'keygen', 'label', 'legend', 'li', 'link', 'main', 'map', 'mark', 'math',\n    'menu', 'meta', 'meter', 'nav', 'noscript', 'object', 'ol', 'optgroup', 'option',\n    'output', 'p', 'param', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's',\n    'samp', 'script', 'section', 'select', 'small', 'source', 'span', 'strong',\n    'style', 'sub', 'summary', 'sup', 'svg', 'table', 'tbody', 'td', 'textarea',\n    'tfoot', 'th', 'thead', 'time', 'title', 'tr', 'track', 'u', 'ul', 'var',\n    'video', 'wbr','altGlyph','altGlyphDef','altGlyphItem','animate','animateColor','animateMotion',\n    'animateTransform','circle','clipPath','color-profile','cursor','defs','desc','discard',\n    'ellipse','feBlend','feColorMatrix','feComponentTransfer','feComposite','feConvolveMatrix',\n    'feDiffuseLighting','feDisplacementMap','feDistantLight','feDropShadow','feFlood','feFuncA',\n    'feFuncB','feFuncG','feFuncR','feGaussianBlur','feImage','feMerge','feMergeNode','feMorphology',\n    'feOffset','fePointLight','feSpecularLighting','feSpotLight','feTile','feTurbulence','filter',\n    'font','font-face','font-face-format','font-face-name','font-face-src','font-face-uri',\n    'foreignObject','g','glyph','glyphRef','hatch','hatchpath','hkern','image','line',\n    'linearGradient','marker','mask','mesh','meshgradient','meshpatch','meshrow','metadata',\n    'missing-glyph','mpath','path','pattern','polygon','polyline','radialGradient','rect','script',\n    'set','solidcolor','stop','style','svg','switch','symbol','text','textPath','title','tref',\n    'tspan','unknown','use','view','vkern'\n  ],\n  cssFuncs: [\n    'attr', 'calc', 'cubic-bezier', 'hsl', 'hsla', 'linear-gradient',\n    'radial-gradient', 'repeating-linear-gradient', 'repeating-radial-gradient',\n    'rgb', 'rgba', 'var', 'translate', 'matrix', 'matrix3d', 'translate', 'translate3d',\n    'translateX', 'translateY', 'translateZ', 'scale', 'scale3d', 'scaleX', 'scaleY',\n    'scaleZ', 'rotate', 'rotate3d', 'rotateX', 'rotateY', 'rotateZ', 'skew', 'skewX',\n    'skewY', 'perspective'\n  ],\n  cssUnits: [\n    'cm', 'mm', 'in', 'px', 'pt', 'pc', 'em', 'ex', 'ch', 'rem', 'vw', 'vh',\n    'vmin', 'vmax', 'deg', 'rad', 's'\n  ],\n  \n  // If there are some new elements that you want to insert into the DOM that\n  // aren't in the hardcoded list above, then you can add them with this\n  // (raise a github issue too, so they can be added to the list if they are\n  // generally useful)\n  addCustomElements: function() {\n    let names = jst._flatten.apply(this, arguments);\n\n    for (let name of names) {\n      let fullName = jst.tagPrefix + name;\n      jst[fullName] = function() {\n        let args = jst._flatten.apply(this, arguments);\n        return (new JstElement(name, args));\n      };\n    }\n  },\n\n  addCssFunctions: function() {\n    let names = jst._flatten.apply(this, arguments);\n    for (let name of names) {\n      let camelName = name.replace(/-([a-z])/g, match => match[1].toUpperCase());\n      jst[camelName] = function() {\n        let args = jst._flatten.apply(this, arguments);\n        return `${name}(${args.join(\",\")})`;\n      };\n    }\n  },\n\n  addCssUnits: function() {\n    let names = jst._flatten.apply(this, arguments);\n    for (let name of names) {\n      jst[name] = function() {\n        let args = jst._flatten.apply(this, arguments);\n        let fixed = args.map(arg => `${arg}${name}`);\n        return fixed.join(\" \") + \" \";\n      };\n    }\n  },\n\n  // Used to associate a generic object with JST so that it can be used\n  // as a refreshable datasource for a template\n  object: function(obj) {\n    if (typeof(obj) != \"object\") {\n      throw(new Error(\"You must pass an object to jst.object()\"));\n    }\n    return obj.$jst = new JstObject(obj);\n  },\n\n  // Put all the element functions (e.g. $div(), $span()) in the global (window)\n  // namespace\n  makeGlobal: function(prefix) {\n    jst.global          = true;\n    jst.globalTagPrefix = prefix || jst.tagPrefix;\n    for (let tag of jst.tags) {\n      let name = jst.globalTagPrefix + tag;\n      let g = typeof global !== 'undefined' ? global : window;\n      g[name] = function() {\n        return jst[name].apply(this, arguments);\n      };\n    }\n  },\n\n  // Check passed in value to see if it is of interest in the following way:\n  //   - is it defined at all?\n  //   - if it is an array, does it have any values?\n  //   - if it is an object, does it have properties?\n  //   - if it is a number, always return true\n  // If the checks fail, then return ifFalse or undefined, otherwise return ifTrue || true\n  //\n  // This can be used to prefix rendering blocks with jst.if(val) && ..., e.g.:\n  //    render() {\n  //      // this works because 'undefined' is silently skipped in Jayesstee\n  //      return jst.if(myList) && jst.$ul(myList.map(item => jst.$li(item)))\n  //    }\n  // or if you prefer, you can do a tertiary expression: jst.if(val) ? ... : ...\n  //\n  // Note that if you pass in a boolean, 'false' will return 'undefined' and 'true'\n  // will return 'true'\n  if: function(val, ifTrue, ifFalse) {\n    ifTrue = ifTrue || true;\n    let type = typeof(val);\n    if (type === \"number\") {\n      return ifTrue;\n    }\n    if (type === \"undefined\" || val === null) {\n      return ifFalse;\n    }\n    if (Array.isArray(val)) {\n      return val.length ? ifTrue : ifFalse;\n    }\n    if (type === \"object\") {\n      return Object.keys(val).length === 0 && val.constructor === Object ? ifTrue : ifFalse;\n    }\n\n    // Catch all including boolean type\n    return val ? ifTrue : ifFalse;\n    \n  },\n\n  // Control debug behaviour - with debug on, jayesstee will include\n  // additional elements in the DOM to make it much easier to debug the\n  // heirarchy\n  setDebug: function(val) {\n    jst.debug = val;\n  },\n\n  //\n  // Internal functions\n  //\n  // Called automatically\n  _init: function() {\n    jst.addCustomElements(jst.tags);\n    jst.addCssFunctions(jst.cssFuncs);\n    jst.addCssUnits(jst.cssUnits);\n    jst.styleManager = new JstStyleManager();\n    if (typeof window !== 'undefined') {\n      jst(\"head\").appendChild(jst.styleManager);\n    }\n    else {\n      global.HTMLElement = class HTMLElement {};\n    }\n  },\n\n  _addCssUnit: function(unit, val) {\n    if (typeof(val) === \"number\") {\n      return `${val}${unit || \"\"}`;\n    }\n    return val && val.toString ? val.toString() : val;\n  },\n\n  _flatten: function() {\n    var flat = [];\n    for (var i = 0; i < arguments.length; i++) {\n      if (arguments[i] instanceof Array) {\n        flat.push.apply(flat, jst._flatten.apply(this, arguments[i]));\n      }\n      else if (arguments[i] instanceof Function) {\n        let result = arguments[i]();\n        if (result instanceof Array) {\n          flat.push.apply(flat, jst._flatten.apply(this, result));\n        }\n        else {\n          flat.push(result);\n        }\n      }\n      else {\n        flat.push(arguments[i]);\n      }\n    }\n    return flat;\n  },\n\n  _normalizeCss: function(input) {\n    // First flatten the top level\n    let flat = jst._flatten(input);\n    let evenFlatter = [];\n    \n    // We should now have a single array that could have objects or values\n    flat.map(entry => {\n      if (entry instanceof Object) {\n        evenFlatter = evenFlatter.concat(jst._normalizeCssObject(entry));\n      }\n      else {\n        evenFlatter.push(entry);\n      }\n    });\n    return evenFlatter;\n  },\n\n  _normalizeCssObject: function(obj) {\n    const atRules = new Set([\"$media\", \"$keyframes\", \"$supports\", \"$page\",\n                             \"$fontFace\", \"$viewport\", \"$counterStyle\",\n                             \"$fontFeatureValues\", \"$swash\", \"$ornaments\",\n                             \"$stylistic\", \"$styleset\", \"$characterVariant\"]);\n    let fixed = [];\n    \n    for (let prop of Object.keys(obj)) {\n\n      let sel;\n      let fixedSetting = {};\n      \n      if (atRules.has(prop)) {\n        let processed = this._normalizeCssObject(obj[prop]);\n        sel = prop.replace(/^\\$/, \"@\").replace(/([A-Z])/g, m => \"-\"+m.toLowerCase());\n        processed.map(item => fixedSetting = Object.assign(fixedSetting, item));\n      }\n      else {\n        \n        let parts = prop.split(\"$\");\n        sel       = parts.shift();\n        for (let part of parts) {\n          if (part === \"c\") {\n            sel = `.${sel}`;\n          }\n          else if (part === \"i\") {\n            sel = `#${sel}`;\n          }\n          else {\n            sel = `${sel}:${part}`;\n          }\n        }\n\n        \n        let setting = jst._flatten(obj[prop]);\n        setting.map(val => {\n          if (val instanceof Object) {\n            fixedSetting = Object.assign(fixedSetting, jst._normalizeCssStyles(val));\n          }\n          else {\n            fixedSetting = val;\n          }\n        });\n\n      }\n      \n      let tmpObj = {};\n      tmpObj[sel] = fixedSetting;\n      fixed.push(tmpObj);\n    }\n    return fixed;\n  },\n\n  _normalizeCssStyles: function(obj) {\n    let fixed = {};\n    for (let prop of Object.keys(obj)) {\n      let val = obj[prop];\n      if (val instanceof Object && !Array.isArray(val)) {\n        if (val.rgb && val.rgb().string) {\n          fixed[prop] = val.rgb().string();\n        }\n        else {\n          let fixedObj = this._normalizeCssStyles(obj[prop]); \n          fixed[prop] = [fixedObj];\n        }\n      }\n      else {\n        let val   = jst._flatten(obj[prop]);\n        let match = prop.match(/^([^$]+)\\$(.+)/);\n        if (match) {\n          val = val.map(item => jst._addCssUnit(match[2], item));\n          fixed[match[1]] = val;\n        }\n        else {\n          fixed[prop] = val;\n        }\n      }\n    }\n    return fixed;\n  }\n  \n\n});\n\njst._init();\n\n"]}